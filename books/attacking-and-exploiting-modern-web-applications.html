
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />

  <!--  <link rel="manifest" href="/assets/site.webmanifest" crossorigin="use-credentials">-->

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://ojack69.github.io/jacks-corner/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://ojack69.github.io/jacks-corner/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://ojack69.github.io/jacks-corner/theme/pygments/emacs.min.css">


  <link rel="stylesheet"
        type="text/css"
        href="https://ojack69.github.io/jacks-corner/theme/stork/stork.css" />

  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/solid.css">

        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/custom.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/zoom.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/collapsible-toc.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/goals.css"> 


      <script src="https://code.jquery.com/jquery-3.7.1.min.js" type="application/javascript"></script>
      <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/collapsible-toc.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/zoom.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/app.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/goals.js" type="application/javascript"></script>











 

<meta name="author" content="Jack69" />
<meta name="description" content="SAML XML-based standard for managing federated authentication and authorization. Typically used to implement web SSO. A user requesting a resource to a Service Provider (SP) is redirected to an Identity Provider (IdP) to perform an authentication. If the authentication is successful, the IdP provides a message, called assertion, containing user&#39;s …" />
<meta name="keywords" content="">


  <meta property="og:site_name" content="Jack's Corner"/>
  <meta property="og:title" content="Attacking and Exploiting Modern Web Applications - S.Onofri | D.Onofri"/>
  <meta property="og:description" content="SAML XML-based standard for managing federated authentication and authorization. Typically used to implement web SSO. A user requesting a resource to a Service Provider (SP) is redirected to an Identity Provider (IdP) to perform an authentication. If the authentication is successful, the IdP provides a message, called assertion, containing user&#39;s …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://ojack69.github.io/jacks-corner/books/attacking-and-exploiting-modern-web-applications.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="1957-01-01 00:00:00+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://ojack69.github.io/jacks-corner/author/jack69.html">
  <meta property="article:section" content="Books"/>
  <meta property="og:image" content="">

  <title>Jack's Corner &ndash; Attacking and Exploiting Modern Web Applications - S.Onofri | D.Onofri</title>


</head>
<body >

<aside>
  <div>
    <a href="https://ojack69.github.io/jacks-corner/">
      <img src="https://ojack69.github.io/jacks-corner/theme/img/profile.png" alt="Jack's Corner" title="Jack's Corner">
    </a>

    <h1>
      <a href="https://ojack69.github.io/jacks-corner/">Jack's Corner</a>
    </h1>


    <div class="stork">
        <input class="stork-input" type="text" autocomplete="off" name="q" data-stork="sitesearch" placeholder="Search..." onclick=""/>
      <div class="stork-output" data-stork="sitesearch-output"></div>
    </div>


    <ul class="social">
      <li>
        <a class="sc-htb"
           href="https://app.hackthebox.com/profile/177323"
           target="_blank">
          <i class="fa-brands fa-htb"></i>
        </a>
      </li>
      <li>
        <a class="sc-thm"
           href="https://tryhackme.com/p/jack69"
           target="_blank">
          <i class="fa-brands fa-thm"></i>
        </a>
      </li>
    </ul>
  </div>
</aside>
  <main>

<nav>
  <a href="https://ojack69.github.io/jacks-corner/">Home</a>

  <a href="https://ojack69.github.io/jacks-corner/categories.html">Categories</a>
  <a href="https://ojack69.github.io/jacks-corner/category/cheatsheet.html">Cheatsheets</a>
  <a href="https://ojack69.github.io/jacks-corner/personal/goals.html">Goals</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="books/attacking-and-exploiting-modern-web-applications">Attacking and Exploiting Modern Web Applications - S.Onofri | D.Onofri</h1>
    <p>

    </p>
  </header>


  <div>
        <div class="toc col-lg-3 hidden-xs hidden-sm">
            <div id="toc"><ul><li><a class="toc-href" href="#saml" title="SAML">SAML</a><ul><li><a class="toc-href" href="#saml-workflow" title="SAML Workflow">SAML Workflow</a></li><li><a class="toc-href" href="#saml-attacks" title="SAML Attacks">SAML Attacks</a><ul><li><a class="toc-href" href="#vulnerable-scenarios" title="Vulnerable Scenarios">Vulnerable Scenarios</a></li></ul></li><li><a class="toc-href" href="#in-depth-on-breaking-saml-be-whoever-you-want-to-be_1" title="In-depth: On Breaking SAML: Be Whoever You Want to Be">In-depth: On Breaking SAML: Be Whoever You Want to Be</a><ul><li><a class="toc-href" href="#xml-signature" title="XML Signature">XML Signature</a></li><li><a class="toc-href" href="#saml-assertion" title="SAML Assertion">SAML Assertion</a></li><li><a class="toc-href" href="#xml-signature-wrapping-xsw" title="XML Signature Wrapping (XSW)">XML Signature Wrapping (XSW)</a></li><li><a class="toc-href" href="#interesting-aspects-and-considerations" title="Interesting Aspects and Considerations">Interesting Aspects and Considerations</a></li></ul></li></ul></li></ul></div>
        </div>
    <h2 id="saml">SAML</h2>
<p>XML-based standard for managing <em>federated authentication and authorization</em>. Typically used to implement web SSO.</p>
<p>A user requesting a resource to a <strong>Service Provider (SP)</strong> is redirected to an <strong>Identity Provider (IdP)</strong> to perform an authentication. If the authentication is successful, the IdP provides a message, called <strong>assertion</strong>, containing user's information.</p>
<h3 id="saml-workflow">SAML Workflow</h3>
<p><img alt="SAML-workflow.png" src="https://ojack69.github.io/jacks-corner/images/books/attacking-and-exploiting-modern-web-applications/SAML-workflow.png"/></p>
<ol>
<li><strong>Resource Access Request</strong>:  the user requests a resource to the SP</li>
<li><strong>SAML Request Generation</strong>: If the user is not logged, the SP generates a SAML request (an XML) containing:<ul>
<li>The redirect ULR where to send the client after authentication i.e. the <strong>Assertion Consumer Service</strong> (ACS).</li>
</ul>
</li>
<li><strong>SAML Request Transmission</strong>: The XML is base64 encoded and sent to the IdP (via user's browser) in the <strong>SAMLRequest</strong> parameter.</li>
<li><strong>SAML Request Verification &amp; Authentication</strong>: The IdP parses the requests and makes the user perform a login.</li>
<li><strong>SAML Response Generation</strong>: If the login is successful, a SAML Response is generated which will contain:<ul>
<li>Request status</li>
<li>The assertion containing user's information</li>
<li>The assertion's subject</li>
<li>Any conditions and attributes
The response is <em>XML signed</em>. The response could also contain information about user's groups and privileges.</li>
</ul>
</li>
<li><strong>SAML Response Transmission</strong>: The XML is base64 encoded and sent to the ACS of the SP (via user's browser) as the <strong>SAMLResponse</strong> parameter in a POST request.</li>
<li><strong>SAML Response Verification</strong>: The SP parses the response and verifies it.</li>
<li><strong>Resource Access Grant</strong>: If the response is verified, the SP grants access to the resource requested.</li>
</ol>
<h3 id="saml-attacks">SAML Attacks</h3>
<p>Since the SAML requests and response are sent by the user's browser, its possible to tamper them. 
Since the ACS trusts the SAML Response because the presence of the signature, the first goal is to have control on it in order to forge verified SAML messages.</p>
<p>This is done by looking for <strong>misconfigurations</strong> or <strong>wrong standard implementations.</strong> Another point of interest could be the <strong>XML parser</strong> or the presence of any Open Redirect vulnerability.</p>
<h4 id="vulnerable-scenarios">Vulnerable Scenarios</h4>
<p>The server accepts unsigned assertions and messages:</p>
<ul>
<li>Check if an assertion and a message get accepted also without signature.<ul>
<li><strong>Signature Exclusion Attack</strong>: relies on poor implementation of a server&rsquo;s security logic, which checks the signature validity only if the signature is included </li>
</ul>
</li>
</ul>
<p>The server requires a message and assertion to be signed but does not verify the certificate used to sign them:</p>
<ul>
<li>Check if it's possible to use self-signed certificates and forge a valid signature</li>
</ul>
<p>The server requires valid signatures but does not check whether the XML structure conforms to the schema provided by the standard or whether there are particular elements (e.g. duplicated IDs/Signature).</p>
<ul>
<li>Check if it's possibile to use <a href="https://www.ws-attacks.org/XML_Signature_Wrapping">XML Signature Wrapping (XSW)</a> by duplicating and modifying elements - The XML parser could be verifying the signature of the original elements meanwhile the application logic could be using the modified ones.</li>
</ul>
<p>Other possible SAML attacks:</p>
<ul>
<li><strong>XML External Entity injection (XEE)</strong>: exploits the lack of input validation when it's possible to inject an XML entity within a server-processed XML document. If the XML parser dereferences it, generally it's possible to retrieve files or make arbitrary request from the server.</li>
<li><strong>Server-Side Request Forgery (SSRF) via Extensible Stylesheet Language Transformations (XSLT)</strong>: exploits the lack of input validation when it's possible to write into XML document processed server-side and a XSLT transformation it's happening on this document. XSLT it's used to transform XML documents in other formats (<a href="https://book.hacktricks.xyz/pentesting-web/xslt-server-side-injection-extensible-stylesheet-language-transformations">see there</a>)</li>
<li><strong>Authentication bypass via XML canonicalization</strong>: canonicalization is the process of space and newlines removal. In the SAML implementations it generally happens before the signature checking; some parsers also remove also comments: it could be possible for an attacker to use XML comments in order to remove part of the strings in assertions while keeping the signature valid.</li>
</ul>
<p>Useful resources:</p>
<ul>
<li>https://cheatsheetseries.owasp.org/cheatsheets/SAML_Security_Cheat_Sheet.html</li>
<li>https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final91.pdf</li>
</ul>
<p>Useful Burp extensions:</p>
<ul>
<li>SAML Rider</li>
</ul>
<h3 id="in-depth-on-breaking-saml-be-whoever-you-want-to-be_1">In-depth: On Breaking SAML: Be Whoever You Want to Be</h3>
<p>XML Signature standard is used in order to protect integrity and authenticity of the exchanged SAML assertions, since them contain security critical claims about a subject.</p>
<p>However, the integrity protection can be circumvented by application of different XML Signature specific attacks like XML Signature wrapping (XSW).</p>
<p>There are two main reason behind the most commonly found SAML vulnerabilities:</p>
<ul>
<li><strong>Complex Signing Algorithm</strong>: Previous digital signature data formats like PKCS#7 and OpenPGP compute a single hash of the whole document, and signatures are simply appended to the document. The XML Signature standard is much more complex. Especially, the position of the signature and the signed content is variable. Therefore, many permutations of the same XML document exist.</li>
<li><strong>Unspecified internal interface</strong>:  two modules - the signature verification module which performs a cryptographic operation, and the SAML processing module which processes the claims contained in the SAML assertion. Both modules can have different views on the assertion, and they typically only exchange a Boolean value about the validity of the signature.</li>
</ul>
<h4 id="xml-signature">XML Signature</h4>
<p>The XML Signature standard defines the syntax and processing rules for creating, representing, and verifying XML-based digital signatures. It is possible to sign a
whole XML tree or only specific elements. One XML Signature can cover several local or global resources.</p>
<ul>
<li><strong>Enveloped Signature</strong>: a signature placed within the signed content.</li>
<li><strong>Enveloping Signature</strong>: a signature that surrounds the signed parts.</li>
<li><strong>Detached Signature</strong>: a signature that is neither inside nor a parent of the signed data.</li>
</ul>
<p>Signature structure:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Signature</span><span class="w"> </span><span class="err">ID?</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;SignedInfo&gt;</span>
<span class="w">        </span><span class="nt">&lt;CanonicalizationMethod/&gt;</span>
<span class="w">        </span><span class="nt">&lt;SignatureMethod/&gt;</span>
<span class="w">        </span>(<span class="nt">&lt;Reference</span><span class="w"> </span><span class="err">URI?</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">            </span>(<span class="nt">&lt;Transforms&gt;</span>)?
<span class="w">            </span><span class="nt">&lt;DigestMethod&gt;</span>
<span class="w">            </span><span class="nt">&lt;DigestValue&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Reference&gt;</span>)+
<span class="w">    </span><span class="nt">&lt;/SignedInfo&gt;</span>
<span class="w">    </span><span class="nt">&lt;SignatureValue&gt;</span>
<span class="w">        </span>(<span class="nt">&lt;KeyInfo&gt;</span>)?
<span class="w">        </span>(<span class="nt">&lt;Object</span><span class="w"> </span><span class="err">ID?</span><span class="nt">&gt;</span>)*
<span class="nt">&lt;/Signature&gt;</span>
</code></pre></div>
<ul>
<li><strong>Reference Element</strong>: represents a signed element<ul>
<li><strong>Digest Value</strong>: the hash value of the resource </li>
<li><strong>DigestMethod</strong>: the used hash algorithm</li>
<li><strong>URI</strong>: reference to the resource </li>
<li><strong>Transforms</strong>:  specifies the processing steps which are applied prior to digesting of the resource. </li>
</ul>
</li>
<li><strong>SignedInfo element</strong>: is a collection of hash values and URIs. The SignedInfo itself is protected by the signature.<ul>
<li><strong>CanonicalizationMethod</strong>: specifies the algorithms used for canonicalization</li>
<li><strong>SignatureMethod</strong>: specifies the algorithms used for signature creation</li>
</ul>
</li>
<li><strong>SignatureValue</strong>: contains the Base64-encoded value of the computed signature<ul>
<li><strong>KeyInfo</strong>: facilitates the transport of signature relevant key management</li>
<li><strong>Object</strong>: optional element that may contain any data</li>
</ul>
</li>
</ul>
<h4 id="saml-assertion">SAML Assertion</h4>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;saml:Assertion</span><span class="w"> </span><span class="err">Version</span><span class="w"> </span><span class="err">ID</span><span class="w"> </span><span class="err">IssueInstant</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;saml:Issuer&gt;</span>
<span class="w">    </span><span class="nt">&lt;ds:Signature&gt;</span>?
<span class="w">    </span><span class="nt">&lt;saml:Subject&gt;</span>?
<span class="w">    </span><span class="nt">&lt;saml:Conditions&gt;</span>?
<span class="w">    </span><span class="nt">&lt;saml:Advice&gt;</span>?
<span class="w">    </span><span class="nt">&lt;saml:AuthnStatement&gt;</span>*
<span class="w">    </span><span class="nt">&lt;saml:AuthzDecisionStatement&gt;</span>*
<span class="w">    </span><span class="nt">&lt;saml:AttributeStatement&gt;</span>*
<span class="nt">&lt;/saml:Assertion&gt;</span>
</code></pre></div>
<ul>
<li><strong>IssueInstant</strong>: specifies issuing time of the assertion</li>
<li><strong>saml:Issuer</strong>: specifies the SAML authority (the IdP) that is making the claim(s) in the assertion. </li>
<li><strong>saml:Subject</strong> defines the principal about whom all statements within the assertion are made. </li>
<li><strong>saml:*Statement</strong>: used to specify user-defined statements relevant for the context of the SAML assertion.</li>
</ul>
<p>The whole <strong>saml:Assertion</strong> element must be protected with a digital signature following the XML Signature standard.
- The <strong>saml:Assertion</strong> element or an ancestor element must be referenced by the Signature element, with an enveloped XML Signature. Furthermore, Id-based referencing must be used.</p>
<h4 id="xml-signature-wrapping-xsw">XML Signature Wrapping (XSW)</h4>
<p>XML documents containing XML Signatures are typically processed in two independent steps:
- signature validation
- function invocation (business logic). </p>
<p>If both modules have different views on the data, a class of vulnerabilities named XML Signature Wrapping attacks (XSW) exists.</p>
<p>In these attacks the adversary modifies the message structure by injecting forged elements which do not invalidate the XML Signature.</p>
<ul>
<li>The goal of this alteration is to change the message in such a way that the application logic and the signature verification module use different parts of the message. so that the XML Signature is verified successfully but the application logic processes the bogus element. </li>
</ul>
<h4 id="interesting-aspects-and-considerations">Interesting Aspects and Considerations</h4>
<ul>
<li><strong>XML Schema validation</strong>: Some of the SAML frameworks check message conformance to the underlying XML schema. Therefore, it is necessary to use XML schema extension points for placing the wrapped content. If the extension elements are not provided in the message, they have to be explicitly included.</li>
<li><strong>Order and position</strong>: The order and position of signed and executed elements in the message tree can force the different processing modules to have inconsistent data views.</li>
<li><strong>Processing of the Ids</strong>: Several SAML frameworks explicitly check, if the Id in the handled assertion is also used in the Reference of the XML Signature. Application of this countermeasure alone does not work, as there is still the option to use more elements with equal Ids.</li>
<li><strong>Placement of the Signature element</strong>: The signature element can be placed in the newly created evil assertion or stay in the original assertion. Both cases must be considered.</li>
<li><strong>Signature exclusion</strong>: the signature validation step could be erroneously omitted when the signature is not provided in the SAML message.</li>
<li><strong>Untrusted signatures</strong>: It is essential to check that the signature was created with a trustworthy key, otherwise, the attacker can forge a signature with any arbitrary key and embed the corresponding certificate in the KeyInfo element.</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>






</article>

<footer>
<p>&copy; Jack69 - 2025 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://ojack69.github.io/jacks-corner/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack's Corner ",
  "url" : "https://ojack69.github.io/jacks-corner",
  "image": "",
  "description": "My personal notes on stuff I like, nothing special"
}
</script>  <script>
    window.loadStorkIndex = function () {
      stork.initialize("https://ojack69.github.io/jacks-corner/theme/stork/stork.wasm")
      stork.register("sitesearch", "https://ojack69.github.io/jacks-corner/search-index.st", { showProgress: false });
    }
  </script>
  <script src="https://ojack69.github.io/jacks-corner/theme/stork/stork.js"></script>

</body>
</html>